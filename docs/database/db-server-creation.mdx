---
sidebar_position: 1
description: ğŸ“Œ Docker ë¥¼ ì´ìš©í•˜ì—¬ DB ì„œë²„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
---

# 1) DB Server Creation
import CodeDescription from '@site/src/components/CodeDescription';
import BrowserWindow from '@site/src/components/BrowserWindow';


### ëª©í‘œ

1. Docker ë¥¼ ì´ìš©í•˜ì—¬ DB ì„œë²„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
2. ìƒì„±ëœ DB ì˜ role name ê³¼ attributes ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

<details>
<summary>ìŠ¤í™ ëª…ì„¸ì„œ</summary>
<CodeDescription>

### ìŠ¤í™ ëª…ì„¸ì„œ

1. Docker ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.
2. PostgreSQL DB ì„œë²„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    - Image : `postgres:14.0`
    - Container name : <code>postgres-server</code>
    - <var>POSTGRES_USER</var> : <code>myuser</code>
    - <var>POSTGRES_PASSWORD</var> : <code>mypassword</code>
    - <var>POSTGRES_DB</var> : <code>mydatabase</code>
    - Port forwarding : `5432:5432`
3. ìƒì„±ëœ DB ì„œë²„ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
    - `psql` ë¡œ DB ì— ì ‘ê·¼í•˜ì—¬ role name ê³¼ attributes í™•ì¸


</CodeDescription>
</details>

---

<BrowserWindow url="https://github.com/mlops-for-mle/mlops-for-mle/tree/main/ch1">

í•´ë‹¹ íŒŒíŠ¸ì˜ ì „ì²´ ì½”ë“œëŠ” [mlops-for-mle/ch1/](https://github.com/mlops-for-mle/mlops-for-mle/tree/main/ch1) ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```js
ch1
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ Makefile
â”œâ”€â”€ data_generator.py
â”œâ”€â”€ data_insertion.py
â”œâ”€â”€ data_insertion_loop.py
â”œâ”€â”€ docker-compose.yaml
â””â”€â”€ table_creator.py
```

</BrowserWindow>

## 1. Docker ì„¤ì¹˜
### 1.1 Docker Desktop
- ì•„ë˜ì˜ ë§í¬ë¥¼ í†µí•´ ê° OS ì— ë§ëŠ” Docker desktop ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤.  
    [Docker: Accelerated, Containerized Application Development](https://www.docker.com/)

### 1.2 Docker Engine
- Ubuntu ì—ì„œ desktop í˜•íƒœê°€ ì•„ë‹Œ engine í˜•íƒœë¡œ ì„¤ì¹˜í•˜ê³  ì‹¶ì„ ê²½ìš°, ì•„ë˜ì˜ ë°©ë²•ì„ í†µí•´ ì„¤ì¹˜í•©ë‹ˆë‹¤.  
    [Install Docker Engine on Ubuntu](https://docs.docker.com/engine/install/ubuntu/)

## 2. DB ì„œë²„ ìƒì„±

`docker run` ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ë©´ ê°„ë‹¨í•œ ì˜µì…˜ë“¤ì„ í†µí•´ DB ì„œë²„ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<CodeDescription>

```bash
# terminal-command
docker run -d \
  --name postgres-server \
  -p 5432:5432 \
  -e POSTGRES_USER=myuser \
  -e POSTGRES_PASSWORD=mypassword \
  -e POSTGRES_DB=mydatabase \
  postgres:14.0
```

- `-d` : ì»¨í…Œì´ë„ˆê°€ detached ëª¨ë“œë¡œ ì‹¤í–‰í•˜ê²Œ ë˜ë©°, `-d` ì˜µì…˜ ì—†ì´ ì‹¤í–‰í–ˆë‹¤ë©´ í•´ë‹¹ í„°ë¯¸ë„ì—ì„œ `Ctrl + C` ë¥¼ ëˆŒëŸ¬ì„œ ë¹ ì ¸ë‚˜ì˜¤ëŠ” ìˆœê°„ í•´ë‹¹ ì»¨í…Œì´ë„ˆëŠ” ì¢…ë£Œë©ë‹ˆë‹¤.
- `â€”-name` : ì»¨í…Œì´ë„ˆì˜ ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” `postgres-server` ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
- `-p` : ì»¨í…Œì´ë„ˆì—ì„œ ì™¸ë¶€ë¡œ ë…¸ì¶œí•  í¬íŠ¸ í¬ì›Œë”© (port forwarding)ì„ ì„¤ì •í•©ë‹ˆë‹¤. í˜•ì‹ì€ `host:container` ìœ¼ë¡œ ì‚¬ìš©ì´ ë˜ë©°, ì—¬ê¸°ì„œëŠ” `5432:5432` ë¡œ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.
- `-e` : í•„ìš”í•œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
    - <var>POSTGRES_USER</var> : User ì˜ ì´ë¦„ì„ ì„¤ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” <code>myuser</code> ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
    - <var>POSTGRES_PASSWORD</var> : User ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” <code>mypassword</code> ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
    - <var>POSTGRES_DB</var> : Database ì˜ ì´ë¦„ì„ ì„¤ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” <code>mydatabase</code> ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
- `postgres:14.0` : ì‚¬ìš©í•  ì´ë¯¸ì§€ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” `postgres:14.0` ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.

</CodeDescription>

`docker ps` ëª…ë ¹ì–´ë¥¼ í†µí•´ DB ì„œë²„ê°€ ì˜ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

```bash
# terminal-command
docker ps
CONTAINER ID   IMAGE           COMMAND                  CREATED          STATUS          PORTS                    NAMES
13bd38add3e7   postgres:14.0   "docker-entrypoint.sâ€¦"   40 seconds ago   Up 39 seconds   0.0.0.0:5432->5432/tcp   postres-server
```

## 3. DB ì„œë²„ í™•ì¸

### 3.1 `psql` ì„¤ì¹˜

PostgreSQL DB ì„œë²„ë¥¼ í™•ì¸í•  ë•Œ ì‚¬ìš©í•˜ëŠ” CLI íˆ´ì¸ `psql` ì„¤ì¹˜í•©ë‹ˆë‹¤. 
[ê³µì‹ í™ˆí˜ì´ì§€](https://www.postgresql.org/download/)ë¥¼ ì°¸ê³ í•´ ë³¸ì¸ì˜ í™˜ê²½ì— ë§ê²Œ ì„¤ì¹˜í•©ë‹ˆë‹¤.

### 3.2 DB ì„œë²„ í™•ì¸

`psql` ì„ í†µí•´ ìƒì„±ëœ PostgreSQL DB ì„œë²„ë¡œ ì ‘ì†í•©ë‹ˆë‹¤.

<CodeDescription>

```bash
# terminal-command
PGPASSWORD=mypassword psql -h localhost -p 5432 -U myuser -d mydatabase
```
- `PGPASSWORD=` : ì ‘ì†í•  user ì˜ ì•”í˜¸ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” `mypassword` ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.
- `-h` : í˜¸ìŠ¤íŠ¸ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ì´ ë•Œ í˜¸ìŠ¤íŠ¸ëŠ” docker ì—ì„œ í¬íŠ¸ í¬ì›Œë”©ì„ í–ˆê¸° ë•Œë¬¸ì— `localhost` ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.
- `-p` : í¬íŠ¸ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” `5432` ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.
- `-U` : ì ‘ì†í•  user ì˜ ì´ë¦„ì„ ì…ë ¥í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” `myuser` ë¥¼ í†µí•´ ì ‘ì†í•©ë‹ˆë‹¤.
- `-d` : database ì˜ ì´ë¦„ì„ ì…ë ¥í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” `mydatabase` ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.

</CodeDescription>

ì ‘ì†ì— ì„±ê³µí•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì¶œë ¥ë©ë‹ˆë‹¤.

```sql
# terminal-command
PGPASSWORD=mypassword psql -h localhost -p 5432 -U myuser -d mydatabase
psql (14.3, server 14.0 (Debian 14.0-1.pgdg110+1))
Type "help" for help.

mydatabase=#
```

`\du` ë¥¼ í†µí•´ DB ì˜ role name ê³¼ attributes ì„ í™•ì¸í•©ë‹ˆë‹¤.

```sql
mydatabase=# \du
List of roles
 Role name |                         Attributes                         | Member of 
-----------+------------------------------------------------------------+-----------
 myuser    | Superuser, Create role, Create DB, Replication, Bypass RLS | {}
```
