---
sidebar_position: 1
description: π“ Docker λ¥Ό μ΄μ©ν•μ—¬ DB μ„λ²„λ¥Ό μƒμ„±ν•©λ‹λ‹¤.
---

# 1) DB Server Creation
import CodeDescription from '@site/src/components/CodeDescription';
import PreviewDescription from '@site/src/components/PreviewDescription';
import BrowserWindow from '@site/src/components/BrowserWindow';

<PreviewDescription>

## Chapter Preview
---
### λ©ν‘

1. Docker λ¥Ό μ΄μ©ν•μ—¬ DB μ„λ²„λ¥Ό μƒμ„±ν•©λ‹λ‹¤.
2. μƒμ„±λ DB μ role name κ³Ό attributes λ¥Ό ν™•μΈν•©λ‹λ‹¤.

### μ¤ν™ λ…μ„Έμ„

1. Docker λ¥Ό μ„¤μΉν•©λ‹λ‹¤.
2. PostgreSQL DB μ„λ²„λ¥Ό μƒμ„±ν•©λ‹λ‹¤.
    - <var>Image</var> : `postgres:14.0`
    - <var>Container name</var> : <code>postgres-server</code>
    - <var>POSTGRES_USER</var> : <code>myuser</code>
    - <var>POSTGRES_PASSWORD</var> : <code>mypassword</code>
    - <var>POSTGRES_DB</var> : <code>mydatabase</code>
    - <var>Port forwarding</var> : <code>5432:5432</code>
3. μƒμ„±λ DB μ„λ²„λ¥Ό ν™•μΈν•©λ‹λ‹¤.
    - `psql` λ΅ DB μ— μ ‘κ·Όν•μ—¬ role name κ³Ό attributes ν™•μΈ


</PreviewDescription>

<BrowserWindow url="https://github.com/mlops-for-mle/mlops-for-mle/tree/main/ch1">

ν•΄λ‹Ή ννΈμ μ „μ²΄ μ½”λ“λ” [mlops-for-mle/ch1/](https://github.com/mlops-for-mle/mlops-for-mle/tree/main/ch1) μ—μ„ ν™•μΈν•  μ μμµλ‹λ‹¤.

```js
ch1
β”β”€β”€ Dockerfile
β”β”€β”€ Makefile
β”β”€β”€ data_generator.py
β”β”€β”€ data_insertion.py
β”β”€β”€ data_insertion_loop.py
β”β”€β”€ docker-compose.yaml
β””β”€β”€ table_creator.py
```

</BrowserWindow>

## 1. Docker μ„¤μΉ
### 1.1 Docker Desktop
- μ•„λμ λ§ν¬λ¥Ό ν†µν•΄ κ° OS μ— λ§λ” Docker desktop μ„ μ„¤μΉν•©λ‹λ‹¤.  
    [Docker: Accelerated, Containerized Application Development](https://www.docker.com/)

### 1.2 Docker Engine
- Ubuntu μ—μ„ desktop ν•νƒκ°€ μ•„λ‹ engine ν•νƒλ΅ μ„¤μΉν•κ³  μ‹¶μ„ κ²½μ°, μ•„λμ λ°©λ²•μ„ ν†µν•΄ μ„¤μΉν•©λ‹λ‹¤.  
    [Install Docker Engine on Ubuntu](https://docs.docker.com/engine/install/ubuntu/)

## 2. DB μ„λ²„ μƒμ„±

`docker run` λ…λ Ήμ–΄λ¥Ό μ΄μ©ν•λ©΄ κ°„λ‹¨ν• μµμ…λ“¤μ„ ν†µν•΄ DB μ„λ²„λ¥Ό μƒμ„±ν•  μ μμµλ‹λ‹¤.

<CodeDescription>

```bash
# terminal-command
docker run -d \
  --name postgres-server \
  -p 5432:5432 \
  -e POSTGRES_USER=myuser \
  -e POSTGRES_PASSWORD=mypassword \
  -e POSTGRES_DB=mydatabase \
  postgres:14.0
```

- <var>-d</var> : 

    - μ»¨ν…μ΄λ„κ°€ detached λ¨λ“λ΅ μ‹¤ν–‰ν•κ² λλ©°, `-d` μµμ… μ—†μ΄ μ‹¤ν–‰ν–λ‹¤λ©΄ ν•΄λ‹Ή ν„°λ―Έλ„μ—μ„ `Ctrl + C` λ¥Ό λλ¬μ„ λΉ μ Έλ‚μ¤λ” μκ°„ ν•΄λ‹Ή μ»¨ν…μ΄λ„λ” μΆ…λ£λ©λ‹λ‹¤.
- <var>--name</var> : 

    - μ»¨ν…μ΄λ„μ μ΄λ¦„μ„ μ§€μ •ν•©λ‹λ‹¤. 
- <var>-p</var> : 

    - μ»¨ν…μ΄λ„μ—μ„ μ™Έλ¶€λ΅ λ…Έμ¶ν•  ν¬νΈ ν¬μ›λ”© (port forwarding) μ„ μ„¤μ •ν•©λ‹λ‹¤. 
    - ν•μ‹μ€ `host:container` μΌλ΅ μ‚¬μ©μ΄ λλ©°, μ—¬κΈ°μ„λ” `5432:5432` λ΅ μ„¤μ •ν•κ² μµλ‹λ‹¤.
- <var>-e</var> : ν•„μ”ν• ν™κ²½ λ³€μλ¥Ό μ„¤μ •ν•©λ‹λ‹¤.

    - <var>POSTGRES_USER</var> : μ μ €μ μ΄λ¦„μ„ μ„¤μ •ν•©λ‹λ‹¤. 
    - <var>POSTGRES_PASSWORD</var> : μ μ €μ λΉ„λ°€λ²νΈλ¥Ό μ„¤μ •ν•©λ‹λ‹¤.
    - <var>POSTGRES_DB</var> : DB μ μ΄λ¦„μ„ μ„¤μ •ν•©λ‹λ‹¤.
- <var>postgres:14.0</var> : 

    - μ‚¬μ©ν•  μ΄λ―Έμ§€λ¥Ό μ§€μ •ν•©λ‹λ‹¤.

</CodeDescription>

`docker ps` λ…λ Ήμ–΄λ¥Ό ν†µν•΄ DB μ„λ²„κ°€ μ μƒμ„±λμ—λ”μ§€ ν™•μΈν•©λ‹λ‹¤.

```bash
# terminal-command
docker ps
CONTAINER ID   IMAGE           COMMAND                  CREATED          STATUS          PORTS                    NAMES
13bd38add3e7   postgres:14.0   "docker-entrypoint.sβ€¦"   40 seconds ago   Up 39 seconds   0.0.0.0:5432->5432/tcp   postres-server
```

## 3. DB μ„λ²„ ν™•μΈ

### 3.1 `psql` μ„¤μΉ

PostgreSQL DB μ„λ²„λ¥Ό ν™•μΈν•  λ• μ‚¬μ©ν•λ” CLI ν΄μΈ `psql` μ„¤μΉν•©λ‹λ‹¤. 
[κ³µμ‹ ν™νμ΄μ§€](https://www.postgresql.org/download/)λ¥Ό μ°Έκ³ ν•΄ λ³ΈμΈμ ν™κ²½μ— λ§κ² μ„¤μΉν•©λ‹λ‹¤.

### 3.2 DB μ„λ²„ ν™•μΈ

`psql` μ„ ν†µν•΄ μƒμ„±λ PostgreSQL DB μ„λ²„λ΅ μ ‘μ†ν•©λ‹λ‹¤.

<CodeDescription>

```bash
# terminal-command
PGPASSWORD=mypassword psql -h localhost -p 5432 -U myuser -d mydatabase
```
- <var>PGPASSWORD=</var> : 

    - μ ‘μ†ν•  μ μ €μ μ•”νΈλ¥Ό μ…λ ¥ν•©λ‹λ‹¤. 
- <var>-h</var> : 

    - νΈμ¤νΈλ¥Ό μ§€μ •ν•©λ‹λ‹¤. 
- <var>-p</var> : 

    - ν¬νΈλ¥Ό μ§€μ •ν•©λ‹λ‹¤. 
- <var>-U</var> : 

    - μ ‘μ†ν•  μ μ €μ μ΄λ¦„μ„ μ…λ ¥ν•©λ‹λ‹¤. 
- <var>-d</var> : 

    - DB μ μ΄λ¦„μ„ μ…λ ¥ν•©λ‹λ‹¤. 

</CodeDescription>

μ ‘μ†μ— μ„±κ³µν•λ©΄ λ‹¤μκ³Ό κ°™μ΄ μ¶λ ¥λ©λ‹λ‹¤.

```sql
# terminal-command
PGPASSWORD=mypassword psql -h localhost -p 5432 -U myuser -d mydatabase
psql (14.3, server 14.0 (Debian 14.0-1.pgdg110+1))
Type "help" for help.

mydatabase=#
```

`\du` λ¥Ό ν†µν•΄ DB μ role name κ³Ό attributes μ„ ν™•μΈν•©λ‹λ‹¤.

```sql
mydatabase=# \du
List of roles
 Role name |                         Attributes                         | Member of 
-----------+------------------------------------------------------------+-----------
 myuser    | Superuser, Create role, Create DB, Replication, Bypass RLS | {}
```
