---
sidebar_position: 2
description: ğŸ“Œ ì—¬ëŸ¬ ê°œì˜ ëª¨ë¸ë“¤ì„ í•˜ë‚˜ì˜ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ì‘ì„±í•©ë‹ˆë‹¤.
---

# 2) Model Pipeline
import CodeDescription from '@site/src/components/CodeDescription';
import BrowserWindow from '@site/src/components/BrowserWindow';
import { Chapter, Part } from '@site/src/components/Highlight';


### ëª©í‘œ

1. ì—¬ëŸ¬ ê°œì˜ ëª¨ë¸ë“¤ì„ í•˜ë‚˜ì˜ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ì‘ì„±í•©ë‹ˆë‹¤.

<details>
<summary>ìŠ¤í™ ëª…ì„¸ì„œ</summary>
<CodeDescription>

### ìŠ¤í™ ëª…ì„¸ì„œ

1. ëª¨ë¸ë“¤ì˜ íŒŒì´í”„ë¼ì¸í™”
    - `scikit-learn` ì— ìˆëŠ” pipeline ì„ ì´ìš©í•©ë‹ˆë‹¤.
2. ì €ì¥ëœ íŒŒì´í”„ë¼ì¸ ê²€ì¦
    - ì €ì¥ëœ íŒŒì´í”„ë¼ì¸ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

</CodeDescription>
</details>

---

<BrowserWindow url="https://github.com/mlops-for-mle/mlops-for-mle/tree/main/ch2">

í•´ë‹¹ íŒŒíŠ¸ì˜ ì „ì²´ ì½”ë“œëŠ” [mlops-for-mle/ch2/](https://github.com/mlops-for-mle/mlops-for-mle/tree/main/ch2) ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```js
ch2
â”œâ”€â”€ Makefile
â”œâ”€â”€ README.md
â”œâ”€â”€ base_train.py
â”œâ”€â”€ base_validate_save_model.py
â”œâ”€â”€ db_train.py
â”œâ”€â”€ db_validate_save_model.py
// highlight-next-line
â”œâ”€â”€ pipeline_train.py
// highlight-next-line
â””â”€â”€ pipeline_validate_save_model.py
```

</BrowserWindow>

## 1. Model Pipeline

### 1.1 Scaler & SVC
<Chapter>1) Base Model Development</Chapter> ì±•í„°ì—ì„œ ì˜ˆì¸¡ì„ ìœ„í•´ ì‚¬ìš©í•œ ëª¨ë¸ì€ scaler ì™€ SVC ë‘ ê°€ì§€ê°€ ìˆì—ˆìŠµë‹ˆë‹¤.
ë˜í•œ SVC ê°€ ì •ìƒì ìœ¼ë¡œ ì˜ˆì¸¡í•˜ê¸° ìœ„í•´ì„œëŠ” scaler ê°€ í•„ìš”í•˜ë‹¤ëŠ” ê²ƒë„ ì•Œì•„ ë³´ì•˜ìŠµë‹ˆë‹¤.
ì¦‰ SVC ëª¨ë¸ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

```python
scaled_X_train = scaler.transform(X_train)
train_pred = classifier.predict(scaled_X_train)
```

í•˜ì§€ë§Œ ìœ„ ë°©ë²•ì€ scaler ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê±°ë‚˜ ë‹¤ë¥¸ scaler ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ëŸ¬í•œ ì‹¤ìˆ˜ë¥¼ ë§‰ì„ ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ëª¨ë¸ë“¤ì„ íŒŒì´í”„ë¼ì¸í™” ì‹œí‚¤ëŠ” ê²ƒì…ë‹ˆë‹¤.
íŒŒì´í”„ë¼ì¸ëœ ëª¨ë¸ì€ ì•„ë˜ì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```python
model_pipeline.predict(X_train)
```

`model_pipeline` ì•ˆì—ëŠ” í•™ìŠµì´ ì™„ë£Œëœ scaler ì™€ SVC ê°€ ê°™ì´ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— ìœ„ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì‹¤ìˆ˜ë¥¼ ì—†ì• ì¤ë‹ˆë‹¤.

ë¬¼ë¡  ì´ ë°©ë²•ì—ë„ ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤. í•œë²ˆ êµ¬ì¶•ëœ íŒŒì´í”„ë¼ì¸ì€ ìˆ˜ì •í•˜ê¸° ì–´ë µë‹¤ëŠ” ì ê³¼ scaler ì²˜ëŸ¼ í•œ ëª¨ë¸ì—ì„œë§Œ ì“°ì´ëŠ”ê²Œ ì•„ë‹ˆë¼ ì—¬ëŸ¬ ëª¨ë¸ì—ë„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê²ƒë“¤ì„ ì¤‘ë³µì ìœ¼ë¡œ í•™ìŠµí•´ì•¼ í•œë‹¤ëŠ” ì ì´ ìˆìŠµë‹ˆë‹¤.

### 1.2 Code
ì§ì ‘ ëª¨ë¸ë“¤ì„ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ì‘ì„±í•´ ë³´ê² ìŠµë‹ˆë‹¤.

`sklearn.pipeline` ì˜ `Pipeline` ì„ í†µí•´ íŒŒì´í”„ë¼ì¸ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë•Œ íŒŒì´í”„ë¼ì¸ ì•ˆì— ë“¤ì–´ê°€ëŠ” ê°’ì€ ë¦¬ìŠ¤íŠ¸ì´ë©° ë¦¬ìŠ¤íŠ¸ ì•ˆì—ëŠ” `(ëª¨ë¸ ì´ë¦„, ëª¨ë¸ ê°ì²´)` ê°€ ê°’ìœ¼ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.

```python  title="pipeline_train.py"
from sklearn.preprocessing import StandardScaler
from sklearn.pipeline import Pipeline
from sklearn.svm import SVC

model_pipeline = Pipeline([("scaler", StandardScaler()), ("svc", SVC())])
```

ì´ì œ ìƒì„±í•œ íŒŒì´í”„ë¼ì¸ì„ í•™ìŠµí•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. í•™ìŠµ ë°©ë²•ì€ ì¼ë°˜ì ì¸ `scikit-learn` ì˜ ëª¨ë¸ì²˜ëŸ¼ ì§„í–‰í•˜ë©´ ë©ë‹ˆë‹¤.

```python  title="pipeline_train.py"
model_pipeline.fit(X_train, y_train)
```

í•™ìŠµì´ ì™„ë£Œëœ íŒŒì´í”„ë¼ì¸ì€ ë°”ë¡œ ì˜ˆì¸¡ì„ í•˜ê±°ë‚˜ ê° ë‹¨ê³„ë³„ë¡œ ì§„í–‰í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ì„œ scaler ë§Œ ì‚¬ìš©í•˜ê³  ì‹¶ì€ ê²½ìš°ì—ëŠ” ì•„ë˜ì²˜ëŸ¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```python  title="pipeline_train.py"
print(model_pipeline[0].transform(X_train[:1]))
# [[-1.71687346 -0.1513372  -1.37527528 -1.29070478]]
```

ë‹¤ìŒìœ¼ë¡œ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ì˜ˆì¸¡ì„ í•˜ê³  ì •í™•ë„ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.

```python  title="pipeline_train.py"
from sklearn.metrics import accuracy_score

train_pred = model_pipeline.predict(X_train)
valid_pred = model_pipeline.predict(X_valid)

train_acc = accuracy_score(y_true=y_train, y_pred=train_pred)
valid_acc = accuracy_score(y_true=y_valid, y_pred=valid_pred)

print("Train Accuracy :", train_acc)
print("Valid Accuracy :", valid_acc)
# Train Accuracy : 0.9833333333333333
# Valid Accuracy : 0.9666666666666667
```

ë§ˆì§€ë§‰ìœ¼ë¡œ ëª¨ë¸ì„ ì €ì¥í•©ë‹ˆë‹¤. <Chapter>1) Base Model Development</Chapter> ì±•í„°ì²˜ëŸ¼ ë”°ë¡œ í•  í•„ìš”ì—†ì´ í•˜ë‚˜ì˜ íŒŒì¼ë¡œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```python  title="pipeline_train.py"
import joblib

joblib.dump(model_pipeline, "model_pipeline.joblib")
```

### 1.3 `pipeline_train.py`

ìœ„ì—ì„œ ì‘ì„±í•œ ì½”ë“œë¥¼ ëª¨ì•„ì„œ `pipeline_train.py` ë¡œ ì‘ì„±í•©ë‹ˆë‹¤.

```python  title="pipeline_train.py"
# pipeline_train.py
import joblib
from sklearn.datasets import load_iris
from sklearn.metrics import accuracy_score
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.pipeline import Pipeline
from sklearn.svm import SVC

# 1. get data
X, y = load_iris(return_X_y=True, as_frame=True)
X_train, X_valid, y_train, y_valid = train_test_split(X, y, train_size=0.8, random_state=2022)

# 2. model development and train
model_pipeline = Pipeline([("scaler", StandardScaler()), ("svc", SVC())])
model_pipeline.fit(X_train, y_train)

train_pred = model_pipeline.predict(X_train)
valid_pred = model_pipeline.predict(X_valid)

train_acc = accuracy_score(y_true=y_train, y_pred=train_pred)
valid_acc = accuracy_score(y_true=y_valid, y_pred=valid_pred)

print("Train Accuracy :", train_acc)
print("Valid Accuracy :", valid_acc)

# 3. save model
joblib.dump(model_pipeline, "model_pipeline.joblib")
```

## 2. `pipeline_validate_save_model.py`

ì €ì¥ëœ íŒŒì´í”„ë¼ì¸ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” ì§€ ê²€ì¦í•˜ê¸° ìœ„í•´ <Chapter>1) Base Model Development</Chapter> ì±•í„°ì—ì„œ ì‘ì„±í•œ `base_validate_save_model.py` ì˜ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì—¬ `pipeline_validate_save_model.py` ë¡œ ì‘ì„±í•©ë‹ˆë‹¤.

```python  title="pipeline_validate_save_model.py"
# pipeline_validate_save_model.py
import joblib
from sklearn.datasets import load_iris
from sklearn.metrics import accuracy_score
from sklearn.model_selection import train_test_split

# 1. reproduce data
X, y = load_iris(return_X_y=True, as_frame=True)
X_train, X_valid, y_train, y_valid = train_test_split(X, y, train_size=0.8, random_state=2022)

# 2. load model
model_pipeline_load = joblib.load("model_pipeline.joblib")

# 3. validate
load_train_pred = model_pipeline_load.predict(X_train)
load_valid_pred = model_pipeline_load.predict(X_valid)

load_train_acc = accuracy_score(y_true=y_train, y_pred=load_train_pred)
load_valid_acc = accuracy_score(y_true=y_valid, y_pred=load_valid_pred)

print("Load Model Train Accuracy :", load_train_acc)
print("Load Model Valid Accuracy :", load_valid_acc)
```
