---
sidebar_position: 4
description: ğŸ“Œ Docker Compose ë¥¼ ì´ìš©í•˜ì—¬ Zookeeper, Broker, Schema Registry, Connect ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
---

# 4) Kafka System
import CodeDescription from '@site/src/components/CodeDescription';
import BrowserWindow from '@site/src/components/BrowserWindow';
import { Chapter, Part } from '@site/src/components/Highlight';
import ArchitectureImage from './img/kafka-13.png';

## ëª©í‘œ

1. Docker Compose ë¥¼ ì´ìš©í•˜ì—¬ Zookeeper, Broker, Schema Registry, Connect ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

<details>
<summary>ìŠ¤í™ ëª…ì„¸ì„œ</summary>
<CodeDescription>

### ìŠ¤í™ ëª…ì„¸ì„œ

1. Zookeeper, Broker, Schema Registry, Connect ë¥¼ ìƒì„±í•˜ëŠ” Docker Compose íŒŒì¼ì„ ì‘ì„±í•©ë‹ˆë‹¤.
    - Zookeeper
        - <var>Service name</var> : <code>zookeeper</code>
        - <var>Image</var> : <code>confluentinc/cp-zookeeper:7.3.0</code>
        - <var>Container name</var> : <code>zookeeper</code>
        - <var>Port</var> : <code>2181:2181</code>
        - <var>Environment</var>

            - <var>ZOOKEEPER_SERVER_ID</var> : <code>1</code>  
            - <var>ZOOKEEPER_CLIENT_PORT</var> : <code>2181</code>
    - Broker
        - <var>Service name</var> : <code>broker</code>
        - <var>Image</var> : <code>confluentinc/cp-kafka:7.3.0</code>
        - <var>Container name</var> : <code>broker</code>
        - <var>Port</var> : <code>9092:9092</code>
        - <var>Environment</var>

            - <var>KAFKA_BROKER_ID</var> : <code>1</code>
            - <var>KAFKA_ZOOKEEPER_CONNECT</var> : <code>zookeeper:2181</code>
            - <var>KAFKA_ADVERTISED_LISTENERS</var> : <code>PLAINTEXT://broker:29092,PLAINTEXT_HOST://localhost:9092</code>
            - <var>KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</var> : <code>PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT</code>
            - <var>KAFKA_INTER_BROKER_LISTENER_NAME</var> : <code>PLAINTEXT</code>
            - <var>KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</var> : <code>1</code>
            - <var>KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS</var> : <code>0</code>
    - Schema-registry
        - <var>Service name</var> : <code>schema-registry</code>
        - <var>Image</var> : <code>confluentinc/cp-schema-registry:7.3.0</code>
        - <var>Container name</var> : <code>schema-registry</code>
        - <var>Port</var> : <code>8081:8081</code>
        - <var>Environment</var>

            - <var>SCHEMA_REGISTRY_HOST_NAME</var> : <code>schema-registry</code>
            - <var>SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS</var> : <code>broker:29092</code>
            - <var>SCHEMA_REGISTRY_LISTENERS</var> : <code>http://schema-registry:8081</code>
    - Connect
        - <var>Service name</var> : <code>connect</code>
        - <var>Image</var> : <code>confluentinc/cp-connect:7.3.0</code> ë¥¼ ì´ìš©í•œ Dockerfile
        
            - <var>Environment</var>
                - <var>CONNECT_PLUGIN_PATH</var> : <code>â€œ/usr/share/java,/usr/share/confluent-hub-componentsâ€</code>
        
            - <var>Run</var>

                - <code>confluent-hub install --no-prompt snowflakeinc/snowflake-kafka-connector:1.5.5</code>
                - <code>confluent-hub install --no-prompt confluentinc/kafka-connect-jdbc:10.2.2</code>
                - <code>confluent-hub install --no-prompt confluentinc/kafka-connect-json-schema-converter:7.3.0</code>
        
        - <var>Container name</var> : <code>connect</code>
        - <var>Port</var> : <code>8083:8083</code>
        - <var>Environment</var>

            - <var>CONNECT_BOOTSTRAP_SERVERS</var> : <code>schema-registry</code>
            - <var>CONNECT_BOOTSTRAP_SERVERS</var> : <code>broker:29092</code>
            - <var>CONNECT_REST_ADVERTISED_HOST_NAME</var> : <code>connect</code>
            - <var>CONNECT_GROUP_ID</var> : <code>docker-connect-group</code>
            - <var>CONNECT_CONFIG_STORAGE_TOPIC</var> : <code>docker-connect-configs</code>
            - <var>CONNECT_CONFIG_STORAGE_REPLICATION_FACTOR</var> : <code>1</code>
            - <var>CONNECT_OFFSET_STORAGE_TOPIC</var> : <code>docker-connect-offsets</code>
            - <var>CONNECT_OFFSET_STORAGE_REPLICATION_FACTOR</var> : <code>1</code>
            - <var>CONNECT_STATUS_STORAGE_TOPIC</var> : <code>docker-connect-status</code>
            - <var>CONNECT_STATUS_STORAGE_REPLICATION_FACTOR</var> : <code>1</code>
            - <var>CONNECT_KEY_CONVERTER</var> : <code>org.apache.kafka.connect.storage.StringConverter</code>
            - <var>CONNECT_VALUE_CONVERTER</var> : <code>org.apache.kafka.connect.json.JsonConverter</code>
            - <var>CONNECT_VALUE_CONVERTER_SCHEMA_REGISTRY_URL</var> : <code>http://schema-registry:8081</code>
2. Docker Compose íŒŒì¼ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
3. `docker ps` ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ì—¬ ì˜ ë„ì›Œì¡ŒëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

</CodeDescription>
</details>

---

<BrowserWindow url="https://github.com/mlops-for-mle/mlops-for-mle/tree/main/ch7">

í•´ë‹¹ íŒŒíŠ¸ì˜ ì „ì²´ ì½”ë“œëŠ” [mlops-for-mle/ch7/](https://github.com/mlops-for-mle/mlops-for-mle/tree/main/ch7) ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```js
ch7
â”œâ”€â”€ Makefile
â”œâ”€â”€ README.md
// highlight-next-line
â”œâ”€â”€ connect.Dockerfile
â”œâ”€â”€ create_table.py
// highlight-next-line
â”œâ”€â”€ kafka-docker-compose.yaml
â”œâ”€â”€ naive-docker-compose.yaml
â”œâ”€â”€ sink_connector.json
â”œâ”€â”€ source_connector.json
â”œâ”€â”€ target-docker-compose.yaml
â””â”€â”€ target.Dockerfile
```

</BrowserWindow>

## 0. í™˜ê²½ ì„¤ì •
:::caution

ğŸ“Œ ì´ë²ˆ ì±•í„°ë¥¼ ì§„í–‰í•˜ê¸° ìœ„í•´ì„œëŠ” ìœ„í•´ì„œ ì•ì„œ <Chapter>2) Producer & Consumer</Chapter> ì±•í„°ì—ì„œ ì‹¤í–‰ëœ Docker Compose ë¥¼ ì¢…ë£Œí•´ì•¼ í•©ë‹ˆë‹¤.
:::

ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ ì¢…ë£Œí•©ë‹ˆë‹¤.

```bash
# terminal-command
docker compose -p ch7-naive down -v
```

## 1. Architecture

[ê·¸ë¦¼ 7-13]ì€ ì´ë²ˆ ì‹¤ìŠµì—ì„œ ë‹¤ë£° ì„œë¹„ìŠ¤ë“¤ì˜ ë‹¤ì´ì–´ê·¸ë¨ì…ë‹ˆë‹¤.

<div style={{textAlign: 'center'}}>

<img src={ArchitectureImage} style={{scale: '70%'}}/>
[ê·¸ë¦¼7-13] Kafka System

</div>

ê°ê°ì˜ ì„œë¹„ìŠ¤ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

- Zookeeper : ë¸Œë¡œì»¤ ì„œë²„ì˜ì˜ ìƒíƒœ ê°ì§€ë¥¼ ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ì£¼í‚¤í¼ ì„œë²„ì…ë‹ˆë‹¤.
- Broker : Source Connector ì—ì„œ ë°ì´í„°ë¥¼ ë°›ì•„ í† í”½ì— ì €ì¥í•˜ê³ , Sink Connector ë¡œ ë°ì´í„°ë¥¼ ë„˜ê²¨ì¤„ ë¸Œë¡œì»¤ ì„œë²„ì…ë‹ˆë‹¤. ì´ë²ˆ ì±•í„°ì—ì„œëŠ” ë‹¤ì¤‘ ë¸Œë¡œì»¤ê°€ ì•„ë‹Œ ë‹¨ì¼ ë¸Œë¡œì»¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- Schema Registry : ë©”ì‹œì§€ì˜ schema ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ Schema Registry ì„œë²„ì…ë‹ˆë‹¤.
- Connect : Connector ë¥¼ ë„ìš°ê¸° ìœ„í•œ Connect ì„œë²„ì…ë‹ˆë‹¤.

ì´ì œ ì„œë¹„ìŠ¤ë¥¼ í•˜ë‚˜ì”© êµ¬ì²´ì ìœ¼ë¡œ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

## 2. Kafka System

### 2.1 Zookeeper & Broker

ì£¼í‚¤í¼ì™€ ë¸Œë¡œì»¤ë¥¼ ë„ìš°ëŠ” ì½”ë“œëŠ” <Chapter>2) Producer & Consumer</Chapter> ì±•í„°ì—ì„œ ì‘ì„±í•œ ë‚´ìš©ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

```yaml  title="kafka-docker-compose.yaml"
version: "3"

services:
  zookeeper:
    image: confluentinc/cp-zookeeper:7.3.0
    container_name: zookeeper
    ports:
      - 2181:2181
    environment:
      ZOOKEEPER_SERVER_ID: 1
      ZOOKEEPER_CLIENT_PORT: 2181
  broker:
    image: confluentinc/cp-kafka:7.3.0
    container_name: broker
    depends_on:
      - zookeeper
    ports:
      - 9092:9092
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://broker:29092,PLAINTEXT_HOST://localhost:9092
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0
```

### 2.2 Schema Registry

ë‹¤ìŒìœ¼ë¡œ Schema Registry ë¥¼ ë„ìš°ëŠ” ì½”ë“œì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

<CodeDescription>

```yaml  title="kafka-docker-compose.yaml"
version: "3"

services:
  schema-registry:
    image: confluentinc/cp-schema-registry:7.3.0
    container_name: schema-registry
    depends_on:
      - broker
    ports:
      - 8081:8081
    environment:
      SCHEMA_REGISTRY_HOST_NAME: schema-registry
      SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS: broker:29092
      SCHEMA_REGISTRY_LISTENERS: http://schema-registry:8081
```

- <var>image</var> : 

  - Schema Registry ì˜ ì´ë¯¸ì§€ë¡œ <code>confluentinc/cp-schema-registry:7.3.0</code> ë¥¼ ì´ìš©í•©ë‹ˆë‹¤.
- <var>container_name</var> : 

  - ì»¨í…Œì´ë„ˆì˜ ì´ë¦„ì€ <code>schema-registry</code> ë¡œ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
- <var>depends_on</var> : 

  - <code>broker</code> ê°€ ë¨¼ì € ì‹¤í–‰ëœ í›„ Schema Registry ê°€ ì‹¤í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
- <var>ports</var> : 

  - Schema Registry ì˜ í¬íŠ¸ì¸ <code>8081:8081</code> ì„ í¬íŠ¸ í¬ì›Œë”©í•©ë‹ˆë‹¤.

Schema Registry ì˜ í™˜ê²½ ë³€ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

<CodeDescription>

- <var>SCHEMA_REGISTRY_HOST_NAME</var>
  
  - Schema Registry ì˜ í˜¸ìŠ¤íŠ¸ ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤.
  - ì´ë²ˆ ì±•í„°ì—ì„œëŠ” <code>schema-registry</code> ë¡œ ì§€ì •í•˜ê² ìŠµë‹ˆë‹¤.
- <var>SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS</var>
  
  - Bootstrap ìœ¼ë¡œ ë„ì›Œì§„ ë¸Œë¡œì»¤ ì„œë²„ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
  - ì¼ë°˜ì ìœ¼ë¡œ <code>ë¸Œë¡œì»¤ ì„œë¹„ìŠ¤ ì´ë¦„ : ë¸Œë¡œì»¤ ì„œë¹„ìŠ¤ ë‚´ë¶€ í¬íŠ¸</code> í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•©ë‹ˆë‹¤.
  - ì´ë²ˆ ì±•í„°ì—ì„œëŠ” <code>broker:29092</code> ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
- <var>SCHEMA_REGISTRY_LISTENERS</var>
  
  - ì™¸ë¶€ì—ì„œ ì ‘ì†í•  ë¦¬ìŠ¤ë„ˆë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
  - ì´ë²ˆ ì±•í„°ì—ì„œëŠ” <code>http://schema-registry:8081</code> ìœ¼ë¡œ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.

</CodeDescription>

</CodeDescription>

### 2.3 Connect

ë‹¤ìŒìœ¼ë¡œ Connect ë¥¼ ìƒì„±í•˜ëŠ” ì½”ë“œì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

Connect ì˜ ê²½ìš° ì´ë¯¸ì§€ë¥¼ build í•˜ê¸° ìœ„í•œ Dockerfile ì´ í•„ìš”í•©ë‹ˆë‹¤.
Dockerfile ì€ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<CodeDescription>

```docker  title="connect.Dockerfile"
# connect.Dockerfile
FROM confluentinc/cp-kafka-connect:7.3.0

ENV CONNECT_PLUGIN_PATH="/usr/share/java,/usr/share/confluent-hub-components"

RUN confluent-hub install --no-prompt snowflakeinc/snowflake-kafka-connector:1.5.5 &&\
  confluent-hub install --no-prompt confluentinc/kafka-connect-jdbc:10.2.2 &&\
  confluent-hub install --no-prompt confluentinc/kafka-connect-json-schema-converter:7.3.0
```

- <var>FROM</var> : 

  - Base ì´ë¯¸ì§€ë¡œ <code>confluentinc/cp-kafka-connect:7.3.0</code> ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
- <var>ENV</var> : 

  - Connect ì—ì„œëŠ” í”ŒëŸ¬ê·¸ì¸ì˜ path ë¥¼ ì„¤ì •í•´ì¤ë‹ˆë‹¤.
  - ì´ë²ˆ ì±•í„°ì—ì„œëŠ” base ì´ë¯¸ì§€ì— ìˆëŠ” <code>/usr/share/java</code> path ì™€ <code>/usr/share/confluent-hub-components</code> path ë¥¼ í”ŒëŸ¬ê·¸ì¸ path ë¡œ ì„¤ì •í•©ë‹ˆë‹¤. 
  - í•©ì³ì„œ <code>/usr/share/java,/usr/share/confluent-hub-components</code> í”ŒëŸ¬ê·¸ì¸ path ë¡œ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
- <var>RUN</var> : 

  - ì´ë²ˆ ì±•í„°ì—ì„œëŠ” JDBC Connector ë¥¼ ì‚¬ìš©í•  ê²ƒì´ë©°, PostgreSQL DB ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•œ Connector ë¥¼ ì„¤ì¹˜í•´ì•¼í•©ë‹ˆë‹¤. 
    - <code>confluent-hub install --no-prompt snowflakeinc/snowflake-kafka-connector:1.5.5</code>
    - <code>confluent-hub install --no-prompt confluentinc/kafka-connect-jdbc:10.2.2</code>
  - ë˜í•œ value schema ì˜ Converter ëŠ” Json Schema Converter ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
    - <code>confluent-hub install --no-prompt confluentinc/kafka-connect-json-schema-converter:7.3.0</code>

</CodeDescription>

ì•ì„œ ì‘ì„±í•œ Dockerfile ì„ ì´ìš©í•œ Connect ì˜ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

<CodeDescription>

```yaml  title="kafka-docker-compose.yaml"
version: "3"

services:  
  connect:
    build:
      context: .
      dockerfile: connect.Dockerfile
    container_name: connect
    depends_on:
      - broker
      - schema-registry
    ports:
      - 8083:8083
    environment:
      CONNECT_BOOTSTRAP_SERVERS: broker:29092
      CONNECT_REST_ADVERTISED_HOST_NAME: connect
      CONNECT_GROUP_ID: docker-connect-group
      CONNECT_CONFIG_STORAGE_TOPIC: docker-connect-configs
      CONNECT_CONFIG_STORAGE_REPLICATION_FACTOR: 1
      CONNECT_OFFSET_STORAGE_TOPIC: docker-connect-offsets
      CONNECT_OFFSET_STORAGE_REPLICATION_FACTOR: 1
      CONNECT_STATUS_STORAGE_TOPIC: docker-connect-status
      CONNECT_STATUS_STORAGE_REPLICATION_FACTOR: 1
      CONNECT_KEY_CONVERTER: org.apache.kafka.connect.storage.StringConverter
      CONNECT_VALUE_CONVERTER: org.apache.kafka.connect.json.JsonConverter
      CONNECT_VALUE_CONVERTER_SCHEMA_REGISTRY_URL: http://schema-registry:8081
```

- <var>build</var> : 
  
  - Dockerfile ì„ build í•˜ê¸° ìœ„í•œ ê²½ë¡œë¡œ <code>.</code> ì„ ì…ë ¥í•˜ê³ , Dockerfile íŒŒì¼ëª…ì¸ <code>connect.Dockerfile</code> ì„ ì…ë ¥í•©ë‹ˆë‹¤.
- <var>container_name</var> : 

  - ì»¨í…Œì´ë„ˆ ì´ë¦„ì€ <code>connect</code> ë¡œ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
- <var>depends_on</var> : 

  - ë¸Œë¡œì»¤ì™€ Schema Registry ê°€ ë¨¼ì € ì‹¤í–‰ëœ ë‹¤ìŒì— Connect ê°€ ì‹¤í–‰ë˜ì•¼ í•©ë‹ˆë‹¤.
- <var>ports</var> : 

  - Connect ì˜ í¬íŠ¸ì¸ <code>8083:8083</code> ë¥¼ í¬íŠ¸ í¬ì›Œë”©í•©ë‹ˆë‹¤.

Connect ì˜ í™˜ê²½ ë³€ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

<CodeDescription>

- <var>CONNECT_BOOTSTRAP_SERVERS</var>

  - Bootstrap ìœ¼ë¡œ ë„ì›Œì§„ ë¸Œë¡œì»¤ ì„œë²„ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
  - ì¼ë°˜ì ìœ¼ë¡œ <code>ë¸Œë¡œì»¤ ì„œë¹„ìŠ¤ ì´ë¦„ : ë¸Œë¡œì»¤ ì„œë¹„ìŠ¤ ë‚´ë¶€ í¬íŠ¸</code> í˜•ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
- <var>CONNECT_REST_ADVERTISED_HOST_NAME</var>

  - Connect ì—ì„œëŠ” REST API ìš”ì²­ì— ëŒ€í•œ ì²˜ë¦¬ì™€ Connector ì˜ ë“±ë¡, ì„¤ì •, ì‹œì‘, ì¢…ë£Œ ë“±ì˜ ì²˜ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” Worker ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.
  - Worker ê°„ì˜ ì—°ê²°ì´ ê°€ëŠ¥í•˜ë„ë¡ í˜¸ìŠ¤íŠ¸ ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤.
- <var>CONNECT_GROUP_ID</var>

  - Connect ì˜ Worker í”„ë¡œì„¸ìŠ¤ ê·¸ë£¹ (ë˜ëŠ” í´ëŸ¬ìŠ¤í„°)ë¥¼ êµ¬ì„±í•˜ëŠ” ë° ì‚¬ìš©í•˜ëŠ” ê³ ìœ í•œ ID ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
  - ë‹¨, Consumer ê·¸ë£¹ ID ì™€ ì¶©ëŒí•˜ë©´ ì•ˆë©ë‹ˆë‹¤.
- <var>CONNECT_CONFIG_STORAGE_TOPIC</var>

  - Connector ì˜ í™˜ê²½ ì„¤ì •ì„ ì €ì¥í•  ë¸Œë¡œì»¤ì˜ í† í”½ ì´ë¦„ì„ ì„¤ì •í•©ë‹ˆë‹¤.
- <var>CONNECT_CONFIG_STORAGE_REPLICATION_FACTOR</var>

  - í™˜ê²½ ì„¤ì •ì„ ì €ì¥í•˜ëŠ” í† í”½ì„ ìƒì„±í•  ë•Œ ì‚¬ìš©í•  Replication Factor ì˜ ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
- <var>CONNECT_OFFSET_STORAGE_TOPIC</var>

  - Connector ì˜ offset ì„ ì €ì¥í•  ë¸Œë¡œì»¤ì˜ í† í”½ ì´ë¦„ì„ ì„¤ì •í•©ë‹ˆë‹¤.
- <var>CONNECT_OFFSET_STORAGE_REPLICATION_FACTOR</var>

  - Offset ì„ ì €ì¥í•˜ëŠ” í† í”½ì„ ìƒì„±í•  ë•Œ ì‚¬ìš©í•  Replication Factor ì˜ ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
- <var>CONNECT_STATUS_STORAGE_TOPIC</var>

  - Connector ì™€ task ì˜ ìƒíƒœë¥¼ ì €ì¥í•  ë¸Œë¡œì»¤ì˜ í† í”½ ì´ë¦„ì„ ì„¤ì •í•©ë‹ˆë‹¤.
- <var>CONNECT_STATUS_STORAGE_REPLICATION_FACTOR</var>

  - ìƒíƒœë¥¼ ì €ì¥í•˜ëŠ” í† í”½ì„ ìƒì„±í•  ë•Œ ì‚¬ìš©í•  Replication Factor ì˜ ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
- <var>CONNECT_KEY_CONVERTER</var>

  - Key ì— ëŒ€í•œ Converter ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
  - ì´ë²ˆ ì±•í„°ì—ì„œëŠ” String Converter ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
- <var>CONNECT_VALUE_CONVERTER</var>

  - Value ì— ëŒ€í•œ Converter ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
  - ì´ë²ˆ ì±•í„°ì—ì„œëŠ” Json Converter ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
- <var>CONNECT_VALUE_CONVERTER_SCHEMA_REGISTRY_URL</var>

  - Value Converter ì— ëŒ€í•œ Schema Registry URL ì„ ì„¤ì •í•©ë‹ˆë‹¤.
  - ì´ë²ˆ ì±•í„°ì—ì„œëŠ” Schema Registry ì˜ ì„œë¹„ìŠ¤ ì´ë¦„ê³¼ í¬íŠ¸ì¸ <code>http://schema-registry:8081</code> ì„ ê¸°ì…í•´ì¤ë‹ˆë‹¤.

</CodeDescription>
</CodeDescription>

### 2.4 `kafka-docker-compose.yaml`

ëª¨ë“  ì„œë¹„ìŠ¤ë¥¼ ë„ìš°ëŠ” ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```yaml
# kafka-docker-compose.yaml
version: "3"

services:
  zookeeper:
    image: confluentinc/cp-zookeeper:7.3.0
    container_name: zookeeper
    ports:
      - 2181:2181
    environment:
      ZOOKEEPER_SERVER_ID: 1
      ZOOKEEPER_CLIENT_PORT: 2181

  broker:
    image: confluentinc/cp-kafka:7.3.0
    container_name: broker
    depends_on:
      - zookeeper
    ports:
      - 9092:9092
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://broker:29092,PLAINTEXT_HOST://localhost:9092
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0

  schema-registry:
    image: confluentinc/cp-schema-registry:7.3.0
    container_name: schema-registry
    depends_on:
      - broker
    ports:
      - 8081:8081
    environment:
      SCHEMA_REGISTRY_HOST_NAME: schema-registry
      SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS: broker:29092
      SCHEMA_REGISTRY_LISTENERS: http://schema-registry:8081

  connect:
    build:
      context: .
      dockerfile: connect.Dockerfile
    container_name: connect
    depends_on:
      - broker
      - schema-registry
    ports:
      - 8083:8083
    environment:
      CONNECT_BOOTSTRAP_SERVERS: broker:29092
      CONNECT_REST_ADVERTISED_HOST_NAME: connect
      CONNECT_GROUP_ID: docker-connect-group
      CONNECT_CONFIG_STORAGE_TOPIC: docker-connect-configs
      CONNECT_CONFIG_STORAGE_REPLICATION_FACTOR: 1
      CONNECT_OFFSET_STORAGE_TOPIC: docker-connect-offsets
      CONNECT_OFFSET_STORAGE_REPLICATION_FACTOR: 1
      CONNECT_STATUS_STORAGE_TOPIC: docker-connect-status
      CONNECT_STATUS_STORAGE_REPLICATION_FACTOR: 1
      CONNECT_KEY_CONVERTER: org.apache.kafka.connect.storage.StringConverter
      CONNECT_VALUE_CONVERTER: org.apache.kafka.connect.json.JsonConverter
      CONNECT_VALUE_CONVERTER_SCHEMA_REGISTRY_URL: http://schema-registry:8081

networks:
  default:
    name: mlops-network
    external: true
```

## 3. ì‹¤í–‰ ë° í™•ì¸

### 3.1 ì‹¤í–‰

`docker compose` ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ì—¬ ìœ„ì—ì„œ ì‘ì„±í•œ ì„œë¹„ìŠ¤ë“¤ì„ ìƒì„±í•©ë‹ˆë‹¤.

<CodeDescription>

```bash
# terminal-command
docker compose -p ch7-kafka -f kafka-docker-compose.yaml up -d
```

- <var>-p</var> : 

  - Project name ì€ <code>ch7-kafka</code> ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
- <var>-f</var> :

  - File name ì€ ìœ„ì—ì„œ ì‘ì„±í•œ íŒŒì¼ ì´ë¦„ì¸ <code>kafka-docker-compose.yaml</code> ì„ ì ì–´ì¤ë‹ˆë‹¤.

</CodeDescription>

### 3.2 ì„œë¹„ìŠ¤ í™•ì¸

`docker ps` ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ì—¬ ì„œë¹„ìŠ¤ë“¤ì´ ì˜ ë„ì›Œì¡ŒëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

```bash
# terminal-command
docker ps
CONTAINER ID   IMAGE                                   COMMAND                  CREATED          STATUS                             PORTS                                        NAMES
2fe161195b13   ch7-kafka-connect                       "/etc/confluent/dockâ€¦"   41 seconds ago   Up 39 seconds (health: starting)   0.0.0.0:8083->8083/tcp, 9092/tcp             connect
4b98228b7e77   confluentinc/cp-schema-registry:7.3.0   "/etc/confluent/dockâ€¦"   41 seconds ago   Up 39 seconds                      0.0.0.0:8081->8081/tcp                       schema-registry
505d3a4d6fdb   confluentinc/cp-kafka:7.3.0             "/etc/confluent/dockâ€¦"   41 seconds ago   Up 40 seconds                      0.0.0.0:9092->9092/tcp                       broker
7f4a6f51837c   confluentinc/cp-zookeeper:7.3.0         "/etc/confluent/dockâ€¦"   42 seconds ago   Up 40 seconds                      2888/tcp, 0.0.0.0:2181->2181/tcp, 3888/tcp   zookeeper
```
