---
sidebar_position: 4
description: ğŸ“Œ Docker Compose ë¥¼ ì´ìš©í•˜ì—¬ Zookeeper, Broker, Schema Registry, Connect ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
---

# 4) Kafka System
import CodeDescription from '@site/src/components/CodeDescription';
import BrowserWindow from '@site/src/components/BrowserWindow';
import { Chapter, Part } from '@site/src/components/Highlight';
import ArchitectureImage from './img/kafka-13.png';

## ëª©í‘œ

1. Docker Compose ë¥¼ ì´ìš©í•˜ì—¬ Zookeeper, Broker, Schema Registry, Connect ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

<details>
<summary>ìŠ¤í™ ëª…ì„¸ì„œ</summary>
<CodeDescription>

### ìŠ¤í™ ëª…ì„¸ì„œ

1. Zookeeper, Broker, Schema-registry, Connect ë¥¼ ìƒì„±í•˜ëŠ” Docker Compose íŒŒì¼ì„ ì‘ì„±í•©ë‹ˆë‹¤.
    - Zookeeper
        - Service name : <code>zookeeper</code>
        - Image : <code>confluentinc/cp-zookeeper:7.3.0</code>
        - Container name : <code>zookeeper</code>
        - Port : <code>2181:2181</code>
        - Environment
            - <var>ZOOKEEPER_SERVER_ID</var> : <code>1</code>
            - <var>ZOOKEEPER_CLIENT_PORT</var> : <code>2181</code>
    - Broker
        - Service name : `broker`
        - Image : `confluentinc/cp-kafka:7.3.0`
        - Container name : `broker`
        - Port : `9092:9092`
        - Environment
            - `KAFKA_BROKER_ID` : `1`
            - `KAFKA_ZOOKEEPER_CONNECT` : `zookeeper:2181`
            - `KAFKA_ADVERTISED_LISTENERS` : `PLAINTEXT://broker:29092,PLAINTEXT_HOST://localhost:9092`
            - `KAFKA_LISTENER_SECURITY_PROTOCOL_MAP` : `PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT`
            - `KAFKA_INTER_BROKER_LISTENER_NAME` : `PLAINTEXT`
            - `KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR` : `1`
            - `KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS` : `0`
    - Schema-registry
        - Service name : `schema-registry`
        - Image : `confluentinc/cp-schema-registry:7.3.0`
        - Container name : `schema-registry`
        - Port : `8081:8081`
        - Environment
            - `SCHEMA_REGISTRY_HOST_NAME` : `schema-registry`
            - `SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS` : `broker:29092`
            - `SCHEMA_REGISTRY_LISTENERS` : `http://schema-registry:8081`
    - Connect
        - Service name : `connect`
        - Image : `confluentinc/cp-connect:7.3.0` ë¥¼ ì´ìš©í•œ Dockerfile
            - Environment
                - `CONNECT_PLUGIN_PATH` : `â€œ/usr/share/java,/usr/share/confluent-hub-componentsâ€`
            - Run
                - `confluent-hub install --no-prompt snowflakeinc/snowflake-kafka-connector:1.5.5`
                - `confluent-hub install --no-prompt confluentinc/kafka-connect-jdbc:10.2.2`
                - `confluent-hub install --no-prompt confluentinc/kafka-connect-json-schema-converter:7.3.0`
        - Container name : `connect`
        - Port : `8083:8083`
        - Environment
            - `CONNECT_BOOTSTRAP_SERVERS` : `schema-registry`
            - `CONNECT_BOOTSTRAP_SERVERS` : `broker:29092`
            - `CONNECT_REST_ADVERTISED_HOST_NAME` : `connect`
            - `CONNECT_GROUP_ID` : `docker-connect-group`
            - `CONNECT_CONFIG_STORAGE_TOPIC` : `docker-connect-configs`
            - `CONNECT_CONFIG_STORAGE_REPLICATION_FACTOR` : `1`
            - `CONNECT_OFFSET_STORAGE_TOPIC` : `docker-connect-offsets`
            - `CONNECT_OFFSET_STORAGE_REPLICATION_FACTOR` : `1`
            - `CONNECT_STATUS_STORAGE_TOPIC` : `docker-connect-status`
            - `CONNECT_STATUS_STORAGE_REPLICATION_FACTOR` : `1`
            - `CONNECT_KEY_CONVERTER` : `org.apache.kafka.connect.storage.StringConverter`
            - `CONNECT_VALUE_CONVERTER` : `org.apache.kafka.connect.json.JsonConverter`
            - `CONNECT_VALUE_CONVERTER_SCHEMA_REGISTRY_URL` : `http://schema-registry:8081`
2. `kafka-docker-compose.yaml` ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
3. `docker ps` ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ì—¬ ì˜ ë„ì›Œì¡ŒëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

</CodeDescription>
</details>

---

<BrowserWindow url="https://github.com/mlops-for-mle/mlops-for-mle/tree/main/ch7">

í•´ë‹¹ íŒŒíŠ¸ì˜ ì „ì²´ ì½”ë“œëŠ” [mlops-for-mle/ch7/](https://github.com/mlops-for-mle/mlops-for-mle/tree/main/ch7) ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```js
ch7
â”œâ”€â”€ Makefile
â”œâ”€â”€ README.md
// highlight-next-line
â”œâ”€â”€ connect.Dockerfile
â”œâ”€â”€ create_table.py
// highlight-next-line
â”œâ”€â”€ kafka-docker-compose.yaml
â”œâ”€â”€ naive-docker-compose.yaml
â”œâ”€â”€ sink_connector.json
â”œâ”€â”€ source_connector.json
â”œâ”€â”€ target-docker-compose.yaml
â””â”€â”€ target.Dockerfile
```

</BrowserWindow>

## 0. í™˜ê²½ ì„¤ì •
:::caution

ğŸ“Œ ì´ë²ˆ ì±•í„°ë¥¼ ì§„í–‰í•˜ê¸° ìœ„í•´ì„œëŠ” ìœ„í•´ì„œ ì•ì„œ <Chapter>2) Producer & Consumer</Chapter> ì±•í„°ì—ì„œ ì‹¤í–‰ëœ docker compose ë¥¼ ì¢…ë£Œí•´ì•¼ í•©ë‹ˆë‹¤.
:::

ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ ì¢…ë£Œí•©ë‹ˆë‹¤.

```bash
# terminal-command
docker compose -p ch7-naive down -v
```

## 1. Architecture

[ê·¸ë¦¼ 7-13]ì€ ì´ë²ˆ ì‹¤ìŠµì—ì„œ ë‹¤ë£° ì„œë¹„ìŠ¤ë“¤ì˜ ë‹¤ì´ì–´ê·¸ë¨ì…ë‹ˆë‹¤.

<div style={{textAlign: 'center'}}>

<img src={ArchitectureImage} style={{scale: '80%'}}/>
[ê·¸ë¦¼7-13] Kafka System

</div>

ê°ê°ì˜ ì„œë¹„ìŠ¤ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

- **Kafka Cluster** : source connector ì—ì„œ ë°ì´í„°ë¥¼ ë°›ì•„ topic ì— ì €ì¥í•˜ê³ , sink connector ë¡œ ë„˜ê²¨ì¤„ kafka cluster ì…ë‹ˆë‹¤. broker ëŠ” multi broker ê°€ ì•„ë‹Œ single broker ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
- **Zookeeper** : broker server ì˜ ìƒíƒœ ê°ì§€ë¥¼ ìœ„í•´ ì‚¬ìš©ë˜ëŠ” zookeeper server ì…ë‹ˆë‹¤.
- **Schema Registry** : ë©”ì‹œì§€ì˜ schema ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ schema registry server ì…ë‹ˆë‹¤.
- **Kafka Connect** : connector ë¥¼ ë„ìš°ê¸° ìœ„í•œ connect server ì…ë‹ˆë‹¤.

ì´ì œ ì„œë¹„ìŠ¤ë¥¼ í•˜ë‚˜ì”© êµ¬ì²´ì ìœ¼ë¡œ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

## 2. Kafka Cluster

### 2.1 Zookeeper & Broker

zookeeper ì™€ broker ë¥¼ ë„ìš°ëŠ” ì½”ë“œëŠ” <Chapter>2) Producer & Consumer</Chapter> ì±•í„°ì—ì„œ ì‘ì„±í•œ ë‚´ìš©ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

```yaml  title="kafka-docker-compose.yaml"
version: "3"

services:
  zookeeper:
    image: confluentinc/cp-zookeeper:7.3.0
    container_name: zookeeper
    ports:
      - 2181:2181
    environment:
      ZOOKEEPER_SERVER_ID: 1
      ZOOKEEPER_CLIENT_PORT: 2181
  broker:
    image: confluentinc/cp-kafka:7.3.0
    container_name: broker
    depends_on:
      - zookeeper
    ports:
      - 9092:9092
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://broker:29092,PLAINTEXT_HOST://localhost:9092
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0
```

### 2.2 Schema-registry

ë‹¤ìŒìœ¼ë¡œ schema-registry ë¥¼ ë„ìš°ëŠ” ì½”ë“œì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

<CodeDescription>

```yaml  title="kafka-docker-compose.yaml"
  schema-registry:
    image: confluentinc/cp-schema-registry:7.3.0
    container_name: schema-registry
    depends_on:
      - broker
    ports:
      - 8081:8081
    environment:
      SCHEMA_REGISTRY_HOST_NAME: schema-registry
      SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS: broker:29092
      SCHEMA_REGISTRY_LISTENERS: http://schema-registry:8081
```

- `image` : schema-registry ì˜ ì´ë¯¸ì§€ë¡œ `confluentinc/cp-schema-registry:7.3.0` ë¥¼ ì´ìš©í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.
- `container_name` : containerì˜ ì´ë¦„ì€ `schema-registry` ë¡œ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
- `depends_on` : `broker` ê°€ ë¨¼ì € ì‹¤í–‰ëœ í›„ schema-registry ì‹¤í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
- `ports` : schema-registry ì˜ í¬íŠ¸ì¸ `8081:8081` ì„ í¬íŠ¸í¬ì›Œë”©í•©ë‹ˆë‹¤.

schema-registry ì˜ í™˜ê²½ ë³€ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

<CodeDescription>

- **SCHEMA_REGISTRY_HOST_NAME**
  - schema-registry ì˜ host name ì„ ì§€ì •í•©ë‹ˆë‹¤.
  - ì´ë²ˆ ì±•í„°ì—ì„œëŠ” `schema-registry` ë¡œ ì§€ì •í•˜ê² ìŠµë‹ˆë‹¤.
- **SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS**
  - bootstrap ìœ¼ë¡œ ë„ì›Œì§„ broker server ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
  - ì¼ë°˜ì ìœ¼ë¡œ `<broker service name>:<broker service internal port>` í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•©ë‹ˆë‹¤.
  - ì´ë²ˆ ì±•í„°ì—ì„œëŠ” `broker:29092` ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
- **SCHEMA_REGISTRY_LISTENERS**
  - ì™¸ë¶€ì—ì„œ ì ‘ì†í•  ë¦¬ìŠ¤ë„ˆë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
  - ì´ë²ˆ ì±•í„°ì—ì„œëŠ” `http://schema-registry:8081` ìœ¼ë¡œ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.

</CodeDescription>

</CodeDescription>

### 2.3 Connect

ë‹¤ìŒìœ¼ë¡œ connect ë¥¼ ë„ìš°ëŠ” ì½”ë“œì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

Connect ì˜ ê²½ìš° image ë¥¼ build í•˜ê¸° ìœ„í•œ `Dockerfile` ì´ í•„ìš”í•©ë‹ˆë‹¤.
Dockerfile ì€ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<CodeDescription>

```docker  title="connect.Dockerfile"
# connect.Dockerfile
FROM confluentinc/cp-kafka-connect:7.3.0

ENV CONNECT_PLUGIN_PATH="/usr/share/java,/usr/share/confluent-hub-components"

RUN confluent-hub install --no-prompt snowflakeinc/snowflake-kafka-connector:1.5.5 &&\
  confluent-hub install --no-prompt confluentinc/kafka-connect-jdbc:10.2.2 &&\
  confluent-hub install --no-prompt confluentinc/kafka-connect-json-schema-converter:7.3.0
```

- `FROM` : base image ë¡œ `confluentinc/cp-kafka-connect:7.3.0` ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
- `ENV` : Connect ì—ì„œëŠ” í”ŒëŸ¬ê·¸ì¸ì˜ path ë¥¼ ì„¤ì •í•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤.
  ì—¬ê¸°ì„œëŠ” base image ì— ìˆëŠ” `/usr/share/java` path ì™€ `/usr/share/confluent-hub-components` path ë¥¼ í”ŒëŸ¬ê·¸ì¸ path ë¡œ ì„¤ì •í•©ë‹ˆë‹¤. í•©ì³ì„œ  `"/usr/share/java,/usr/share/confluent-hub-components"` í”ŒëŸ¬ê·¸ì¸ path ë¡œ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
- `RUN` : ë‹¤ìŒìœ¼ë¡œ image ë¥¼ ë§Œë“¤ ë•Œ ì‹¤í–‰í•  ì½”ë“œë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” JDBC connector ë¥¼ ì‚¬ìš©í•  ê²ƒì´ë©°, PostgreSQL ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•œ connector ë¥¼ ì„¤ì¹˜í•´ì•¼í•©ë‹ˆë‹¤. ë˜í•œ value schema ì˜ converter ëŠ” json converter ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •í•œ í”ŒëŸ¬ê·¸ì¸ path ë¥¼ í†µí•´ ì•„ë˜ì˜ 3ê°€ì§€ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ connector ì™€ converter ì— í•„ìš”í•œ ê¸°ëŠ¥ë“¤ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤.
    - `confluent-hub install --no-prompt snowflakeinc/snowflake-kafka-connector:1.5.5`
    - `confluent-hub install --no-prompt confluentinc/kafka-connect-jdbc:10.2.2`
    - `confluent-hub install --no-prompt confluentinc/kafka-connect-json-schema-converter:7.3.0`

</CodeDescription>

ì•ì„œ ì‘ì„±í•œ Dockerfile ì„ ì´ìš©í•œ connect ì˜ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

<CodeDescription>

```yaml  title="kafka-docker-compose.yaml"
  connect:
    build:
      context: .
      dockerfile: connect.Dockerfile
    container_name: connect
    depends_on:
      - broker
      - schema-registry
    ports:
      - 8083:8083
    environment:
      CONNECT_BOOTSTRAP_SERVERS: broker:29092
      CONNECT_REST_ADVERTISED_HOST_NAME: connect
      CONNECT_GROUP_ID: docker-connect-group
      CONNECT_CONFIG_STORAGE_TOPIC: docker-connect-configs
      CONNECT_CONFIG_STORAGE_REPLICATION_FACTOR: 1
      CONNECT_OFFSET_STORAGE_TOPIC: docker-connect-offsets
      CONNECT_OFFSET_STORAGE_REPLICATION_FACTOR: 1
      CONNECT_STATUS_STORAGE_TOPIC: docker-connect-status
      CONNECT_STATUS_STORAGE_REPLICATION_FACTOR: 1
      CONNECT_KEY_CONVERTER: org.apache.kafka.connect.storage.StringConverter
      CONNECT_VALUE_CONVERTER: org.apache.kafka.connect.json.JsonConverter
      CONNECT_VALUE_CONVERTER_SCHEMA_REGISTRY_URL: http://schema-registry:8081
```

- `build` : `Dockerfile` ì„ build í•˜ê¸° ìœ„í•´ ê²½ë¡œë¡œ `.` ì„ `dockerfile` íŒŒì¼ëª…ì¸ `connect.Dockerfile` ì„ ì…ë ¥í•©ë‹ˆë‹¤.
- `container_name` : container ì˜ ì´ë¦„ìœ¼ë¡œ `connect` ë¡œ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
- `depends_on` : `broker` ì™€ `schema-registry` ê°€ ë¨¼ì € ì‹¤í–‰ëœ ë‹¤ìŒì— connect ê°€ ì‹¤í–‰ë˜ì•¼ í•©ë‹ˆë‹¤.
- `ports` : connect ì˜ port ì¸ `8083:8083` ë¥¼ í¬íŠ¸í¬ì›Œë”©í•©ë‹ˆë‹¤.

Connect ì˜ í™˜ê²½ ë³€ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

<CodeDescription>

- **CONNECT_BOOTSTRAP_SERVERS**
  - bootstrap ìœ¼ë¡œ ë„ì›Œì§„ broker server ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
  - ì¼ë°˜ì ìœ¼ë¡œ  `<broker service name>:<broker service internal port>` í˜•ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **CONNECT_REST_ADVERTISED_HOST_NAME**
  - kafka broker ì—ì„œ bootstrap ìœ¼ë¡œ ë„ì›Œì§„ server ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
  - ì¼ë°˜ì ìœ¼ë¡œ  `<broker service name>:<broker service internal port>` í˜•ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **CONNECT_GROUP_ID**
  - connect cluster ê·¸ë£¹ì—ì„œ ê°ê°ì˜ connect ë¥¼ ì‹ë³„í•  ë•Œ í•„ìš”í•œ ID ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
- **CONNECT_CONFIG_STORAGE_TOPIC**
  - connector config ë¥¼ ì €ì¥í•  broker ì˜ topic ëª…ì„ ì„¤ì •í•©ë‹ˆë‹¤.
- **CONNECT_CONFIG_STORAGE_REPLICATION_FACTOR**
  - config ë¥¼ ì €ì¥í•˜ëŠ” topic ì„ ìƒì„±í•  ë•Œ ì‚¬ìš©í•  replication factor ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
  - ì´ë²ˆ ì±•í„°ì—ì„œëŠ” `1`ë¡œ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.
- **CONNECT_OFFSET_STORAGE_TOPIC**
  - connector offset ì„ ì €ì¥í•  broker ì˜ topic ëª…ì„ ì„¤ì •í•©ë‹ˆë‹¤.
- **CONNECT_OFFSET_STORAGE_REPLICATION_FACTOR**
  - offset ì„ ì €ì¥í•˜ëŠ” topic ì„ ìƒì„±í•  ë•Œ ì‚¬ìš©í•  replication factor ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
  - ì´ë²ˆ ì±•í„°ì—ì„œëŠ” `1`ë¡œ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.
- **CONNECT_STATUS_STORAGE_TOPIC**
  - connector ì™€ task ì˜ ìƒíƒœë¥¼ ì €ì¥í•  broker ì˜ topic ëª…ì„ ì„¤ì •í•©ë‹ˆë‹¤.
- **CONNECT_STATUS_STORAGE_REPLICATION_FACTOR**
  - ìƒíƒœë¥¼ ì €ì¥í•˜ëŠ” topic ì„ ìƒì„±í•  ë•Œ ì‚¬ìš©í•  replication factor ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
  - ì´ë²ˆ ì±•í„°ì—ì„œëŠ” `1`ë¡œ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.
- **CONNECT_KEY_CONVERTER**
  - key ì— ëŒ€í•œ converter ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
  - ì´ë²ˆ ì±•í„°ì—ì„œëŠ” string converter ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ `org.apache.kafka.connect.storage.StringConverter` ë¥¼ ê¸°ì…í•´ì¤ë‹ˆë‹¤.
- **CONNECT_VALUE_CONVERTER**
  - value ì— ëŒ€í•œ converter ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
  - ì´ë²ˆ ì±•í„°ì—ì„œëŠ” json converter ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ `org.apache.kafka.connect.json.JsonConverter` ë¥¼ ê¸°ì…í•´ì¤ë‹ˆë‹¤.
- **CONNECT_VALUE_CONVERTER_SCHEMA_REGISTRY_URL**
  - value converter ì— ëŒ€í•œ schema registry url ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
  - ì´ë²ˆ ì±•í„°ì—ì„œëŠ” ì•ì„œ ì‚´í´ë³¸ schema registry ì˜ service name ê³¼ port ì¸ `http://schema-registry:8081` ë¥¼ ê¸°ì…í•´ì¤ë‹ˆë‹¤.

</CodeDescription>
</CodeDescription>

### 2.4 ì „ì²´ ì½”ë“œ

ëª¨ë“  ì„œë¹„ìŠ¤ë¥¼ ë„ìš°ëŠ” ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```yaml
# kafka-docker-compose.yaml
version: "3"

services:
  zookeeper:
    image: confluentinc/cp-zookeeper:7.3.0
    container_name: zookeeper
    ports:
      - 2181:2181
    environment:
      ZOOKEEPER_SERVER_ID: 1
      ZOOKEEPER_CLIENT_PORT: 2181

  broker:
    image: confluentinc/cp-kafka:7.3.0
    container_name: broker
    depends_on:
      - zookeeper
    ports:
      - 9092:9092
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://broker:29092,PLAINTEXT_HOST://localhost:9092
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0

  schema-registry:
    image: confluentinc/cp-schema-registry:7.3.0
    container_name: schema-registry
    depends_on:
      - broker
    ports:
      - 8081:8081
    environment:
      SCHEMA_REGISTRY_HOST_NAME: schema-registry
      SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS: broker:29092
      SCHEMA_REGISTRY_LISTENERS: http://schema-registry:8081

  connect:
    build:
      context: .
      dockerfile: connect.Dockerfile
    container_name: connect
    depends_on:
      - broker
      - schema-registry
    ports:
      - 8083:8083
    environment:
      CONNECT_BOOTSTRAP_SERVERS: broker:29092
      CONNECT_REST_ADVERTISED_HOST_NAME: connect
      CONNECT_GROUP_ID: docker-connect-group
      CONNECT_CONFIG_STORAGE_TOPIC: docker-connect-configs
      CONNECT_CONFIG_STORAGE_REPLICATION_FACTOR: 1
      CONNECT_OFFSET_STORAGE_TOPIC: docker-connect-offsets
      CONNECT_OFFSET_STORAGE_REPLICATION_FACTOR: 1
      CONNECT_STATUS_STORAGE_TOPIC: docker-connect-status
      CONNECT_STATUS_STORAGE_REPLICATION_FACTOR: 1
      CONNECT_KEY_CONVERTER: org.apache.kafka.connect.storage.StringConverter
      CONNECT_VALUE_CONVERTER: org.apache.kafka.connect.json.JsonConverter
      CONNECT_VALUE_CONVERTER_SCHEMA_REGISTRY_URL: http://schema-registry:8081

networks:
  default:
    name: mlops-network
    external: true
```

## 3. ì‹¤í–‰

### 3.1 ì‹¤í–‰

`docker compose` ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ì—¬ ìœ„ì—ì„œ ì‘ì„±í•œ ì„œë¹„ìŠ¤ë“¤ì„ ë„ì›Œë´…ë‹ˆë‹¤.

<CodeDescription>

```bash
# terminal-command
docker compose -p ch7-kafka -f kafka-docker-compose.yaml up -d
```

- `-p` : project name ì„ `ch7-kafka` ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
- `-f` :file name ì€ ìœ„ì—ì„œ ì‘ì„±í•œ íŒŒì¼ ì´ë¦„ì¸ `kafka-docker-compose.yaml`ì„ ì ì–´ì¤ë‹ˆë‹¤.

</CodeDescription>

### 3.2 ì‹¤í–‰ í™•ì¸

`docker ps` ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ì—¬ ì„œë¹„ìŠ¤ë“¤ì´ ì˜ ë„ì›Œì¡ŒëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

```bash
# terminal-command
docker ps
CONTAINER ID   IMAGE                                   COMMAND                  CREATED          STATUS                             PORTS                                        NAMES
2fe161195b13   ch7-kafka-connect                       "/etc/confluent/dockâ€¦"   41 seconds ago   Up 39 seconds (health: starting)   0.0.0.0:8083->8083/tcp, 9092/tcp             connect
4b98228b7e77   confluentinc/cp-schema-registry:7.3.0   "/etc/confluent/dockâ€¦"   41 seconds ago   Up 39 seconds                      0.0.0.0:8081->8081/tcp                       schema-registry
505d3a4d6fdb   confluentinc/cp-kafka:7.3.0             "/etc/confluent/dockâ€¦"   41 seconds ago   Up 40 seconds                      0.0.0.0:9092->9092/tcp                       broker
7f4a6f51837c   confluentinc/cp-zookeeper:7.3.0         "/etc/confluent/dockâ€¦"   42 seconds ago   Up 40 seconds                      2888/tcp, 0.0.0.0:2181->2181/tcp, 3888/tcp   zookeeper
```
