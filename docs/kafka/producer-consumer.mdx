---
sidebar_position: 2
description: ğŸ“Œ Docker Compose ë¥¼ ì´ìš©í•´ zookeeper ì™€ Kafka broker ë¥¼ ë„ì›Œë´…ë‹ˆë‹¤.
---

# 2) Producer & Consumer
import CodeDescription from '@site/src/components/CodeDescription';
import BrowserWindow from '@site/src/components/BrowserWindow';


### ëª©í‘œ

1. Docker Compose ë¥¼ ì´ìš©í•´ zookeeper ì™€ Kafka broker ë¥¼ ë„ì›Œë´…ë‹ˆë‹¤.
2. Producer ì™€ consumer ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
3. Producer ì—ì„œ ë©”ì‹œì§€ë¥¼ ìƒì„±í•˜ê³ , consumer ì—ì„œ ë©”ì‹œì§€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

<details>
<summary>ìŠ¤í™ ëª…ì„¸ì„œ</summary>
<CodeDescription>

### ìŠ¤í™ ëª…ì„¸ì„œ

1. Zookeeper ì™€ kafka broker ë¥¼ ë„ìš°ëŠ” `naive-docker-compose.yaml` íŒŒì¼ì„ ì‘ì„±í•©ë‹ˆë‹¤.
    - Zookeeper
        - Service name : `zookeeper`
        - Image : `confluentinc/cp-zookeeper:7.3.0`
        - Container name : `zookeeper`
        - Port : `2181:2181`
        - Environment
            - `ZOOKEEPER_SERVER_ID` : `1`
            - `ZOOKEEPER_CLIENT_PORT` : `2181`
    - Broker
        - Service name : `broker`
        - Image : `confluentinc/cp-kafka:7.3.0`
        - Container name : `broker`
        - Port : `9092:9092`
        - Environment
            - `KAFKA_BROKER_ID` : `1`
            - `KAFKA_ZOOKEEPER_CONNECT` : `zookeeper:2181`
            - `KAFKA_ADVERTISED_LISTENERS` : `PLAINTEXT://broker:29092,PLAINTEXT_HOST://localhost:9092`
            - `KAFKA_LISTENER_SECURITY_PROTOCOL_MAP` : `PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT`
            - `KAFKA_INTER_BROKER_LISTENER_NAME` : `PLAINTEXT`
            - `KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR` : `1`
            - `KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS` : `0`
2. `naive-docker-compose.yaml` ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
3. `docker compose exec` ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ì—¬ topic ì„ ìƒì„±í•©ë‹ˆë‹¤.
    - Topic name : `topic-test`
    - Partition count : 1
    - Replication factor count : 1
4. í„°ë¯¸ë„ì—ì„œ `docker compose exec` ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ì—¬ broker ì— ì ‘ì†í•œ ë’¤, `kafka-console-consumer` ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ì—¬ consumer ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
    - Topic name : `topic-test`
    - Bootstrap server : `broker:29092`
5. ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ `docker compose exec` ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ì—¬ broker ì— ì ‘ì†í•œ ë’¤, `kafka-console-producer` ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ì—¬ producer ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
    - Topic name : `topic-test`
    - Broker list : `broker:29092`
6. Producer ì—ì„œ ë©”ì‹œì§€ë¥¼ ìƒì„±í•˜ê³ , consumer ì—ì„œ ë©”ì‹œì§€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

</CodeDescription>
</details>

---

<BrowserWindow url="https://github.com/mlops-for-mle/mlops-for-mle/tree/main/ch7">

í•´ë‹¹ íŒŒíŠ¸ì˜ ì „ì²´ ì½”ë“œëŠ” [mlops-for-mle/ch7/](https://github.com/mlops-for-mle/mlops-for-mle/tree/main/ch7) ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```js
ch7
â”œâ”€â”€ Makefile
â”œâ”€â”€ README.md
â”œâ”€â”€ connect.Dockerfile
â”œâ”€â”€ create_table.py
â”œâ”€â”€ kafka-docker-compose.yaml
// highlight-next-line
â”œâ”€â”€ naive-docker-compose.yaml
â”œâ”€â”€ sink_connector.json
â”œâ”€â”€ source_connector.json
â”œâ”€â”€ target-docker-compose.yaml
â””â”€â”€ target.Dockerfile
```

</BrowserWindow>

## 1. Zookeeper & Kafka Broker setup

Zookeeper ì™€ Kafka Broker ë¥¼ ë„ìš°ëŠ” `naive-docker-compose.yaml` íŒŒì¼ì„ ì‘ì„±í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

### 1.1 Zookeeper service

ë¨¼ì €, Zookeeper service ë¥¼ ë„ìš¸ ë•Œ ì“°ì´ëŠ” ìš”ì†Œë“¤ì— ëŒ€í•´ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

<CodeDescription>

```yaml  title="naive-docker-compose.yaml"
version: "3"

services:
	zookeeper:
    image: confluentinc/cp-zookeeper:7.3.0
    container_name: zookeeper
    ports:
      - 2181:2181
    environment:
      ZOOKEEPER_SERVER_ID: 1
      ZOOKEEPER_CLIENT_PORT: 2181
```
- `image` : zookeeper ë¥¼ ë„ìš¸ ë•Œ ì“°ì´ëŠ” image ë¥¼ ëª…ì‹œí•©ë‹ˆë‹¤. ì´ë²ˆ ì±•í„°ì—ì„œëŠ” `confluentinc/cp-zookeeper:7.3.0` ë¥¼ ì´ìš©í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.
- `container_name` : container ì˜ ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤. ì´ë²ˆ ì±•í„°ì—ì„œëŠ” `zookeeper` ë¡œ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
- `ports` : zookeeper ì˜ port ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ì´ë²ˆ ì±•í„°ì—ì„œëŠ” `2181:2181` ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.

zookeeper ì˜ í™˜ê²½ ë³€ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

<CodeDescription>

- **ZOOKEEPER_SERVER_ID**
  - zookeeper cluster ì—ì„œ í•´ë‹¹ zookeeper ë¥¼ ì‹ë³„í•  ID ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
  - <u>ì´ë²ˆ ì±•í„°ì—ì„œëŠ” ID ë¥¼ 1ë¡œ ì§€ì •í•˜ê² ìŠµë‹ˆë‹¤.</u>
- **ZOOKEEPER_CLIENT_PORT**
  - zookeeper client ì˜ port ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. container ë‚´ë¶€ì—ì„œ zookeeper ëŠ” ì§€ì •ëœ port ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.
  - <u>ì´ë²ˆ ì±•í„°ì—ì„œëŠ” ê¸°ë³¸ zookeeper ì˜ port ì¸ 2181 ë¡œ ì§€ì •í•˜ê² ìŠµë‹ˆë‹¤.</u>

</CodeDescription>

</CodeDescription>

### 1.2 Kafka Broker service

ë‹¤ìŒìœ¼ë¡œ Kafka Broker service ë¥¼ ë„ìš¸ ë•Œ ì“°ì´ëŠ” ìš”ì†Œë“¤ì— ëŒ€í•´ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” single broker ë¥¼ ê°€ì •í•˜ê³  ì‘ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.

<CodeDescription>

```yaml  title="naive-docker-compose.yaml"
broker:
    image: confluentinc/cp-kafka:7.3.0
    container_name: broker
    depends_on:
      - zookeeper
    ports:
      - 9092:9092
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://broker:29092,PLAINTEXT_HOST://localhost:9092
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0
```

- `image` : broker ë¥¼ ë„ìš¸ ë•Œ ì“°ì´ëŠ” image ë¥¼ ëª…ì‹œí•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” `confluentinc/cp-kafka:7.3.0` ë¥¼ ì´ìš©í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.
- `container_name` : container ì˜ ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” `broker` ë¡œ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
- `depends_on` : service ê°„ì˜ ì¢…ì†ì„±ì„ ì„¤ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” `zookeeper` ê°€ ë¨¼ì € ë„ì›Œì§„ ë‹¤ìŒì— broker ë„ì›Œì ¸ì•¼í•¨ìœ¼ë¡œ `zookeeper` ë¥¼ ì ì–´ì¤ë‹ˆë‹¤.
- `ports` : broker ì˜ port ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” `9092:9092` ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.

Broker ì˜ í™˜ê²½ ë³€ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

<CodeDescription>

- **KAFKA_SERVER_ID**
  - broker ì˜ ID ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
  - Single broker ì—ì„œëŠ” ì—†ì–´ë„ ë¬´ë°©í•˜ë‚˜ <u>ì´ë²ˆ ì±•í„°ì—ì„œëŠ” 1ë¡œ ì§€ì •í•˜ê² ìŠµë‹ˆë‹¤.</u>
- **KAFKA_ZOOKEEPER_CONNECT**
  - Broker ê°€ zookeeper ì— connection í•˜ê¸° ìœ„í•œ ì£¼ì†Œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
  - ì¼ë°˜ì ìœ¼ë¡œ `<zookeeper service name>:<zookeeper service port>` í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•©ë‹ˆë‹¤.
  - <u>ì´ë²ˆ ì±•í„°ì—ì„œëŠ” `zookeeper:2181` ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.</u>
- **KAFKA_ADVERTISED_LISTENERS**
  - ë‚´ë¶€ì™€ ì™¸ë¶€ì—ì„œ ì ‘ì†í•˜ê¸° ìœ„í•œ ë¦¬ìŠ¤ë„ˆë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
  - ì¼ë°˜ì ìœ¼ë¡œ internal ê³¼ external ë¥¼ ê°™ì´ ì„¤ì •í•˜ë©° `,` ë¡œ ì—°ê²°í•´ì„œ ì‘ì„±í•©ë‹ˆë‹¤.
  - ì´ë²ˆ ì±•í„°ì—ì„œëŠ” internal ë¡œ `PLAINTEXT://broker:29092` ë¡œ ì„¤ì •í•˜ê³ , external ë¡œ `PLAINTEXT_HOST://localhost:9092` ìœ¼ë¡œ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.
    - <u>ìµœì¢…ì ìœ¼ë¡œ `PLAINTEXT://broker:29092,PLAINTEXT_HOST://localhost:9092` ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.</u>
- **KAFKA_LISTENER_SECURITY_PROTOCOL_MAP**
  - ë³´ì•ˆì„ ìœ„í•œ protocol mappingì„ ì„¤ì •í•©ë‹ˆë‹¤.
  - ì´ ì„¤ì •ê°’ì€ `KAFKA_ADVERTISED_LISTENERS` ê³¼ í•¨ê»˜ key/value ë¡œ ë§¤í•‘ë©ë‹ˆë‹¤.
  - <u>ì´ë²ˆ ì±•í„°ì—ì„œëŠ” `PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT` ë¡œ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.</u>
- **KAFKA_INTER_BROKER_LISTENER_NAME**
  - container ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•  ë¦¬ìŠ¤ë„ˆ ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤.
  - <u>ì´ë²ˆ ì±•í„°ì—ì„œëŠ” ì•ì„œ internal ë¡œ ì„¤ì •í–ˆë˜ `PLAINTEXT` ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.</u>
- **KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR**
  - topic ì„ ë¶„ì‚°í•˜ì—¬ ì €ì¥í•  replication factor ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
  - ê¸°ë³¸ê°’ì€ 3ìœ¼ë¡œ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ ìë™ìœ¼ë¡œ multi brokerë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.
  - <u>ì´ë²ˆ ì±•í„°ì—ì„œëŠ” single broker ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— 1ë¡œ ì§€ì •í•˜ê² ìŠµë‹ˆë‹¤.</u> 
- **KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS**
  - kafka cluster ì—ì„œ ì´ˆê¸°ì— rebalancing í•  ë•Œ consumer ë“¤ì´ consumer group ì— ì¡°ì¸í•  ë•Œ ëŒ€ê¸°í•˜ëŠ” ì‹œê°„ì…ë‹ˆë‹¤.
  - <u>ì´ë²ˆ ì±•í„°ì—ì„œëŠ” 0ìœ¼ë¡œ ì„¤ì •í•´ì¤ë‹ˆë‹¤.</u>

</CodeDescription>

</CodeDescription>


### 1.3 ì „ì²´ ì½”ë“œ

ìµœì¢…ì ì¸ `naive-docker-compose.yaml` êµ¬ì„±ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```yaml  title="naive-docker-compose.yaml"
version: "3"

services:
  zookeeper:
    image: confluentinc/cp-zookeeper:7.3.0
    container_name: zookeeper
    ports:
      - 2181:2181
    environment:
      ZOOKEEPER_SERVER_ID: 1
      ZOOKEEPER_CLIENT_PORT: 2181
  broker:
    image: confluentinc/cp-kafka:7.3.0
    container_name: broker
    depends_on:
      - zookeeper
    ports:
      - 9092:9092
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://broker:29092,PLAINTEXT_HOST://localhost:9092
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0
```

### 1.4 ì‹¤í–‰

ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í™œìš©í•´ ì •ì˜ëœ ì„œë¹„ìŠ¤ë¥¼ ë°±ê·¸ë¼ìš´ë“œ í”„ë¡œì„¸ìŠ¤ë¡œ ë„ì›ë‹ˆë‹¤.

```bash
# terminal-command
docker compose -p ch7-naive -f naive-docker-compose.yaml up -d
```

`docker ps` ë¥¼ ì…ë ¥í•˜ì—¬ ì˜ ë„ì›Œì¡ŒëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

```bash
# terminal-command
docker ps
CONTAINER ID   IMAGE                             COMMAND                  CREATED          STATUS          PORTS                                        NAMES
0a0599db4d96   confluentinc/cp-kafka:7.3.0       "/etc/confluent/dockâ€¦"   28 seconds ago   Up 27 seconds   0.0.0.0:9092->9092/tcp                       broker
35cdc624ac34   confluentinc/cp-zookeeper:7.3.0   "/etc/confluent/dockâ€¦"   28 seconds ago   Up 27 seconds   2888/tcp, 0.0.0.0:2181->2181/tcp, 3888/tcp   zookeeper
```

## 2. Producer & Consumer setup

ì´ë²ˆì—ëŠ” topic ì„ ìƒì„±í•´ë³´ê³ , ì´ì–´ì„œ producer ì™€ consumer ë¥¼ ìƒì„±í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

### 2.1 Topic

#### 2.1.1 Topic ìƒì„±

ì´ì œ Topic ì„ ìƒì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.

<CodeDescription>

```bash
# terminal-command
docker compose exec broker kafka-topics --create --topic topic-test --bootstrap-server broker:29092 --partitions 1 --replication-factor 1
```

- `docker compose exec` : container ë‚´ì— ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
- `broker` : ìƒì„±ëœ broker service ì˜ ì´ë¦„ì„ ì ìŠµë‹ˆë‹¤.
- `kafka-topics` : kafka topic ì— ëŒ€í•œ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
- `--create` : topic ì„ ìƒì„±í•©ë‹ˆë‹¤.
- `--topic` : ìƒì„±í•  topic ì˜ ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” `topic-test` ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ìƒì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.
- `--bootstrap-server` : broker service ì— ëŒ€í•œ hostname ì™€ port ë¥¼  ì§€ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ì•ì„œ docker-compose ë¡œ ë„ì› ë˜ broker ì˜ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì°¸ê³ í•˜ì—¬ `broker:29092` ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
- `--partition` : topic ë‚´ì— partition ê°œìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” 1ë¡œ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.
- `--replication-factor` : replication factor ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” 1ë¡œ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.

</CodeDescription>

#### 2.1.1 Topic ìƒì„± í™•ì¸
ì´ì–´ì„œ topic ì´ ì˜ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

<CodeDescription>

```bash
# terminal-command
docker compose exec broker kafka-topics --describe --topic topic-test --bootstrap-server broker:29092
```

- `--describe` :  ìƒì„±ëœ topic ì— ëŒ€í•œ ìƒì„¸ ì„¤ëª…ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.

</CodeDescription>

ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì¶œë ¥ë©ë‹ˆë‹¤.

```bash
Topic: topic-test       TopicId: pcR8cByuSVG1p1guQ3MFRg PartitionCount: 1       ReplicationFactor: 1   Configs: 
        Topic: topic-test       Partition: 0    Leader: 1       Replicas: 1     Isr: 1
```

ìœ„ì—ì„œ ì…ë ¥í•œ `topic-test` ê°€ ìƒì„±ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 2.2 Consumer

ì´ì œ topic ì„ ìƒì„±í–ˆìœ¼ë‹ˆ ìƒì„±í•œ topic ì„ ì‚¬ìš©í•  consumer ë¥¼ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤.  
Consumer ë¥¼ ë¨¼ì € ì‹¤í–‰í•˜ëŠ” ì´ìœ ëŠ” ì¼ë°˜ì ìœ¼ë¡œ consumer ê°€ ë©”ì‹œì§€ë¥¼ subscribe í•˜ë ¤ê³  ëŒ€ê¸°í•˜ëŠ” ìƒíƒœì—ì„œ producer ê°€ ë©”ì‹œì§€ë¥¼ ìƒì„±í•´ì„œ ë³´ë‚´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

#### 2.2.1 Kafka Container ì ‘ì†
ë¨¼ì € `docker compose exec` ëª…ë ¹ì–´ë¥¼ í†µí•´ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ë¡œ ì ‘ì†í•©ë‹ˆë‹¤.

```bash
# terminal 1
# terminal-command
docker compose -p ch7-naive exec broker /bin/bash
```

ì»¨í…Œì´ë„ˆì— ì ‘ì†í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ í„°ë¯¸ë„ì´ ì—´ë¦½ë‹ˆë‹¤.

```bash
# terminal-command
[appuser@0a0599db4d96 ~]$
```

#### 2.2.2 Counsumer ì‹¤í–‰
ì´í›„ì— `kafka-console-consumer` ë¥¼ ì´ìš©í•˜ì—¬ `topic-test` topic ì„ subscribe í•©ë‹ˆë‹¤.

<CodeDescription>

```bash  title="[appuser@0a0599db4d96 ~]$"
# terminal-command
kafka-console-consumer --topic topic-test --bootstrap-server broker:29092
```
- Topic ì„ ìƒì„±í–ˆë˜ ê²ƒì²˜ëŸ¼ bootstrap-server ë¥¼ `broker:29092` ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

</CodeDescription>

ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì‹ ì„ ëŒ€ê¸°í•˜ê³  ìˆëŠ” ìƒíƒœê°€ ë©ë‹ˆë‹¤.

```bash
[appuser@0a0599db4d96 ~]$ kafka-console-consumer --topic topic-test --bootstrap-server broker:29092

```

### 2.3 Producer
ë§ˆì§€ë§‰ìœ¼ë¡œ producer ë¥¼ ë§Œë“¤ì–´ì„œ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ì¤€ë¹„ë¥¼ í•˜ê² ìŠµë‹ˆë‹¤.

#### 2.3.1 Kafka Container ì ‘ì†

Consumer ì™€ ë˜‘ê°™ì´, `docker compose exec` ëª…ë ¹ì–´ë¥¼ í†µí•´ container ë‚´ë¶€ë¡œ ì ‘ì†í•©ë‹ˆë‹¤. 

:::caution

ì´ ë•Œ consumer ë¥¼ ì‹¤í–‰í–ˆë˜ terminal ì´ ì•„ë‹Œ ìƒˆë¡œìš´ terminal ë¡œ ë„ì›ë‹ˆë‹¤.

:::


```bash
# terminal 2
# terminal-command
docker compose -p ch7-naive exec broker /bin/bash
```

ì ‘ì†ë˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ í„°ë¯¸ë„ì´ ì—´ë¦½ë‹ˆë‹¤.

```bash
# terminal-command
[appuser@0a0599db4d96 ~]$ 
```

#### 2.3.2 Producer ì‹¤í–‰

ì´í›„ì— `kafka-console-producer` ë¥¼ ì´ìš©í•˜ì—¬ `topic-test` topic ì— ì ‘ê·¼í•˜ì—¬ publish í•  ì¤€ë¹„ë¥¼ í•©ë‹ˆë‹¤.

```bash  title="[appuser@0a0599db4d96 ~]$ "
# terminal-command
kafka-console-producer --topic topic-test --broker-list broker:29092
```

ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ publish í•  ìˆ˜ ìˆëŠ” ìƒíƒœê°€ ë©ë‹ˆë‹¤.

```bash
[appuser@0a0599db4d96 ~]$ kafka-console-producer --topic topic-test --broker-list broker:29092
> 
```

### 2.4 Communicate

#### 2.4.1 Producer ì— ë©”ì‹œì§€ ì…ë ¥í•˜ê¸°

Producer ê°€ ì—´ë ¤ ìˆëŠ” ë‘ ë²ˆì§¸ í„°ë¯¸ë„ì—ì„œ ì•„ë˜ì™€ ê°™ì´ `hello`, `this is mlops for mle` ë¥¼ ì…ë ¥í•´ë´…ë‹ˆë‹¤.

```bash
[appuser@0a0599db4d96 ~]$ kafka-console-producer --topic topic-test --broker-list broker:29092
> hello
> this is mlops for mle
```

#### 2.4.2 Conumer ì—ì„œ ë©”ì‹œì§€ ê²°ê³¼ ë³´ê¸°

Consumer ì—ì„œ ì•„ë˜ì˜ ë©”ì‹œì§€ê°€ ì „ë‹¬ë¨ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
hello
this is mlops for mle
```

### 2.5 ì¢…ë£Œ
ëª¨ë“  ê³¼ì •ì´ ì¢…ë£Œë˜ì—ˆìœ¼ë©´ zookeeper ì™€ broker ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.

```bash
# terminal-command
docker compose -p ch7-naive down -v
```
