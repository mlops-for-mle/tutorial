---
sidebar_position: 1
description: ğŸ“Œ Docker Compose ë¥¼ ì´ìš©í•˜ì—¬ ì‹¤ì œ ì„œë¹„ìŠ¤ í™˜ê²½ê³¼ ë¹„ìŠ·í•œ í˜•íƒœë¡œ MLflow ì„œë²„ë¥¼ ë„ì›Œë´…ë‹ˆë‹¤.
---
# 1) MLflow Setup
import CodeDescription from '@site/src/components/CodeDescription';
import BrowserWindow from '@site/src/components/BrowserWindow';
import WorkflowImage from './img/model-registry-2.png';
import { Chapter, Part } from '@site/src/components/Highlight';

### ëª©í‘œ

1. Docker Compose ë¥¼ ì´ìš©í•˜ì—¬ ì‹¤ì œ ì„œë¹„ìŠ¤ í™˜ê²½ê³¼ ë¹„ìŠ·í•œ í˜•íƒœë¡œ MLflow ì„œë²„ë¥¼ ë„ì›Œë´…ë‹ˆë‹¤.
2. ì„œë¹„ìŠ¤ ìƒí™©ì„ ê°€ì •í•˜ì—¬ MLflow ì˜ êµ¬ì„± ìš”ì†Œë“¤ì„ ì´í•´í•©ë‹ˆë‹¤.

<details>
<summary>ìŠ¤í™ ëª…ì„¸ì„œ</summary>
<CodeDescription>

### ìŠ¤í™ ëª…ì„¸ì„œ

1. Docker Compose íŒŒì¼ì— MLflow ì˜ ìš´ì˜ ì •ë³´, ëª¨ë¸ ê²°ê³¼ ë“±ì„ ì €ì¥í•  ë¬¼ë¦¬ì ì¸ PostgreSQL DB ì„œë²„ ìŠ¤í™ì„ ì •ì˜í•©ë‹ˆë‹¤.
    - <var>POSTGRES_USER</var> : <code>mlflowuser</code>
    - <var>POSTGRES_PASSWORD</var> : <code>mlflowpassword</code>
    - <var>POSTGRES_DB</var> : <code>mlflowdatabase</code>
2. Docker Compose íŒŒì¼ì— í•™ìŠµëœ ëª¨ë¸ì„ ì €ì¥í•  ë¬¼ë¦¬ì ì¸ ì €ì¥ ê³µê°„ì¸ MinIO ì„œë²„ ìŠ¤í™ì„ ì •ì˜ í•©ë‹ˆë‹¤.
    - <var>MINIO_ROOT_USER</var> : <code>minio</code>
    - <var>MINO_ROOT_PASSWORD</var> : <code>miniostorage</code>
    - <var>Port forwarding</var> :

      - <var>api</var>: <code>9000:9000</code>
      - <var>console</var>: <code>9001:9001</code>
3. Docker Compose íŒŒì¼ì— ëª¨ë¸ê³¼ ëª¨ë¸ì˜ ê²°ê³¼ë“¤ì„ ê´€ë¦¬í•  MLFlow ì„œë²„ë¥¼ ì •ì˜ í•©ë‹ˆë‹¤.
    - í™˜ê²½ ë³€ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ MLflow ì„œë²„ì—ì„œ ì•ì„œ ë„ì›Œë‘” PostgreSQL DB ì™€ MinIO ë‘ ê°€ì§€ ì„œë²„ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë„ë¡ ì—°ê²°í•©ë‹ˆë‹¤.
    - Dockerfile
        - MLflow ì— ê´€ë ¨ëœ íŒ¨í‚¤ì§€ê°€ ì„¤ì¹˜ëœ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ Dockerfile ì„ ì •ì˜í•©ë‹ˆë‹¤.
        - MinIO ì— ëª¨ë¸ ì €ì¥ì„ ìœ„í•œ ì´ˆê¸° ë²„ì¼“ì„ ìƒì„± í•˜ê¸° ìœ„í•´ MinIO Client ë„ í•¨ê»˜ ì„¤ì¹˜ë˜ë„ë¡ í•©ë‹ˆë‹¤.
    - Docker Compose
      - MinIO ì˜ ì ‘ì† ì •ë³´ë¥¼ <var>AWS_ACCESS_KEY_ID</var> , <var>AWS_SECRET_ACCESS_KEY</var> í™˜ê²½ ë³€ìˆ˜ë¥¼ í†µí•´ ì ì ˆí•˜ê²Œ ì„¤ì •í•©ë‹ˆë‹¤.
      - MinIO Client ë¥¼ ì„¤ì¹˜í•˜ê³ , MinIO ì˜ ì´ˆê¸° ë²„ì¼“ì„ ìƒì„±í•˜ë„ë¡ ëª…ë ¹ì–´ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
      - MLflow ì„œë²„ë¥¼ ë„ìš°ëŠ” ëª…ë ¹ì–´ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
      - Port forwarding : <code>5001:5000</code>
        - MLflow ì—ì„œëŠ” ê¸°ë³¸ê°’ìœ¼ë¡œ 5000 í¬íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
        - í•˜ì§€ë§Œ ì‹¤ìŠµì—ì„œ MacOS ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° AirPlay ê¸°ëŠ¥ì´ 5000ë²ˆ í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì¤‘ë³µì„ í”¼í•˜ê¸° ìœ„í•´ 5001ë²ˆ í¬íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
        - ì¼ë°˜ì ì¸ ê²½ìš° 5000ë²ˆ í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.
4. ì •ì˜ëœ ìŠ¤í™ì— ë”°ë¼ ì„œë¹„ìŠ¤ë“¤ì„ ë„ì›ë‹ˆë‹¤.
    - localhost:9001 ì— ì ‘ì†í•˜ì—¬ MinIO ë¡œê·¸ì¸ í˜ì´ì§€ê°€ ì˜ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
    - localhost:5001 ì— ì ‘ì†í•˜ì—¬ MLflow í˜ì´ì§€ê°€ ì˜ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

</CodeDescription>
</details>

---

<BrowserWindow url="https://github.com/mlops-for-mle/mlops-for-mle/tree/main/ch3">

í•´ë‹¹ íŒŒíŠ¸ì˜ ì „ì²´ ì½”ë“œëŠ” [mlops-for-mle/ch3/](https://github.com/mlops-for-mle/mlops-for-mle/tree/main/ch3) ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```js
ch3
// highlight-next-line
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ Makefile
â”œâ”€â”€ README.md
// highlight-next-line
â”œâ”€â”€ docker-compose.yaml
â”œâ”€â”€ load_model_from_registry.py
â””â”€â”€ save_model_to_registry.py
```

</BrowserWindow>

<div style={{textAlign: 'center'}}>

<img src={WorkflowImage} style={{scale: '70%'}}/>
[ê·¸ë¦¼ 3-2] MLflow Setup Diagram
</div>

## 1. MLflow Backend Store

### 1.1 Backend Store

Backend Store ë€ ìˆ˜ì¹˜ ë°ì´í„°ì™€ MLflow ì„œë²„ì˜ ì •ë³´ë“¤ì„ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•œ DB ì…ë‹ˆë‹¤. 
Backend Store ì—ëŠ” ëª¨ë¸ì˜ í•™ìŠµ ê²°ê³¼ì¸ accuracy, f1-score, ëª¨ë¸ì´ í•™ìŠµë˜ë©´ì„œ ìƒê¸°ëŠ” loss, ëª¨ë¸ ìì²´ì˜ ì •ë³´ì¸ hyperparmameters ë“±ì˜ ìˆ˜ì¹˜ ë°ì´í„°ì™€ run_id, run_name, experiment_name ë“±ì˜ MLflow ì˜ ë©”íƒ€ ë°ì´í„°ê°€ ì €ì¥ë©ë‹ˆë‹¤.

ì´ë²ˆ íŒŒíŠ¸ì—ì„œëŠ” Backend Store ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ <Part>01. Database</Part> íŒŒíŠ¸ì—ì„œ ì‚¬ìš©ë˜ì—ˆë˜ PostgreSQL DB ë¥¼ ìƒˆë¡­ê²Œ ìƒì„±í•˜ê² ìŠµë‹ˆë‹¤.

### 1.2 PostgreSQL DB Server

PostgreSQL DB ì„œë²„ì˜ ìŠ¤í™ì„ Docker Compose íŒŒì¼ì— ì„œë¹„ìŠ¤ ì´ë¦„, ìœ ì € ì´ë¦„, ë¹„ë°€ë²ˆí˜¸, DB ì´ë¦„ì„ í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

<CodeDescription>

```yaml  title="docker-compose.yaml"
version: "3"

services:
  mlflow-backend-store:
    image: postgres:14.0
    container_name: mlflow-backend-store
    environment:
      POSTGRES_USER: mlflowuser
      POSTGRES_PASSWORD: mlflowpassword
      POSTGRES_DB: mlflow
    healthcheck:
      test: ["CMD", "pg_isready", "-q", "-U", "mlflowuser", "-d", "mlflow"]
      interval: 10s
      timeout: 5s
      retries: 5
```

- <var>image</var> :

  - DB ì„œë²„ì—ì„œ ì‚¬ìš©í•  ì´ë¯¸ì§€ëŠ” `postgres:14.0` ì…ë‹ˆë‹¤.
- <var>environment</var> :  

  - <var>POSTGRES_USER</var> : DB ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ì‚¬ìš©ì ì´ë¦„ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” <code>mlflowuser</code> ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
  - <var>POSTGRES_PASSWORD</var> : DB ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” <code>mlflowpassword</code> ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
  - <var>POSTGRES_DB</var> : DB ì´ë¦„ì„ ì„¤ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” <code>mlflowdatabase</code> ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
- <var>healthcheck</var> :

  - DB ì„œë²„ê°€ ì˜ ë„ì›Œì¡ŒëŠ”ì§€ ìƒíƒœë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ìƒíƒœë¥¼ ì²´í¬í•©ë‹ˆë‹¤.

</CodeDescription>

## 2. MLflow Artifact Store

### 2.1 Artifact Store

Artifact Store ë€ MLflow ì—ì„œ í•™ìŠµëœ ëª¨ë¸ì„ ì €ì¥í•˜ëŠ” Model Registry ë¡œì¨ ì´ìš©í•˜ê¸° ìœ„í•œ ìŠ¤í† ë¦¬ì§€ (storage) ì„œë²„ì…ë‹ˆë‹¤. 
Artifact Store ë¥¼ ì´ìš©í•˜ë©´ ê¸°ë³¸ì ì¸ íŒŒì¼ ì‹œìŠ¤í…œ ë³´ë‹¤ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬ í•  ìˆ˜ ìˆìœ¼ë©° ì™¸ë¶€ì— ìˆëŠ” ìŠ¤í† ë¦¬ì§€ ì„œë²„ë„ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆìŠµë‹ˆë‹¤. 

### 2.2 Why MinIO?
ì´ë²ˆ íŒŒíŠ¸ì—ì„œëŠ” Artifact Store ë¡œ MinIO ì„œë²„ë¥¼ ì‚¬ìš©í•˜ëŠ”ë° ê·¸ ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- [MinIO](https://en.wikipedia.org/wiki/MinIO) ëŠ” S3 ë¥¼ ëŒ€ì²´í•  ìˆ˜ ìˆëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ ê³ ì„±ëŠ¥ ê°œì²´ ìŠ¤í† ë¦¬ì§€ì…ë‹ˆë‹¤.
- AWS S3 ì˜ API ì™€ë„ í˜¸í™˜ë˜ì–´ SDK ë„ ë™ì¼í•˜ê²Œ ì‚¬ìš© í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- MLflow ì—ì„œëŠ” AWS S3 ë¥¼ ëª¨ë¸ì„ ì €ì¥í•˜ê¸° ìœ„í•œ ìŠ¤í† ë¦¬ì§€ë¡œ ì‚¬ìš©í•˜ë„ë¡ ê¶Œì¥í•˜ê³  ìˆê¸° ë•Œë¬¸ì— MinIO ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- ì‹¤ìŠµì—ì„œ AWS credential ì„ í†µí•´ MinIO ëŒ€ì‹  AWS S3 ë¥¼ ì‚¬ìš©í•´ë„ ê°™ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 2.3 MinIO Server

MinIOì˜ ìŠ¤í™ì„ Compose íŒŒì¼ì— ì„œë¹„ìŠ¤ ì´ë¦„, ìœ ì € ì´ë¦„, ë¹„ë°€ë²ˆí˜¸ë¥¼ í™˜ê²½ë³€ìˆ˜ë¡œ ì •ì˜í•˜ê³  í˜¸ìŠ¤íŠ¸ì™€ ì—°ê²°ë˜ëŠ” í¬íŠ¸ ë˜í•œ ì •ì˜í•©ë‹ˆë‹¤.

<CodeDescription>

```yaml  title="docker-compose.yaml"
version: "3"

services:
  mlflow-artifact-store:
    image: minio/minio
    container_name: mlflow-artifact-store
    ports:
      - 9000:9000
      - 9001:9001
    environment:
      MINIO_ROOT_USER: minio
      MINIO_ROOT_PASSWORD: miniostorage
    command: server /data/minio --console-address :9001
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 30s
      timeout: 20s
      retries: 3
```

- <var>image</var> : 
  
  - MinIO ì„œë²„ì—ì„œ ì‚¬ìš©í•  ì´ë¯¸ì§€ëŠ” <code>minio/minio</code> ì…ë‹ˆë‹¤.
- <var>ports</var> :

  - í˜¸ìŠ¤íŠ¸ì™€ ì»¨í…Œì´ë„ˆì˜ í¬íŠ¸ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
  - MinIO ì˜ API í¬íŠ¸ë¥¼ 9000ìœ¼ë¡œ í¬íŠ¸ í¬ì›Œë”©í•©ë‹ˆë‹¤.
  - MinIO ì˜ Console í¬íŠ¸ë¥¼ 9001ìœ¼ë¡œ í¬íŠ¸ í¬ì›Œë”©í•©ë‹ˆë‹¤.
- <var>environment</var> :

  - <var>MINIO_ROOT_USER</var> : MinIO ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ì‚¬ìš©ì ì´ë¦„ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” <code>minio</code> ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
  - <var>MINIO_ROOT_PASSWORD</var> : MinIO ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” <code>miniostorage</code> ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.

- <var>command</var> : 

  - MinIO ì„œë²„ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ëª…ë ¹ì–´ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. 
  - <code>--console-address</code> ë¥¼ í†µí•´ ì»¨í…Œì´ë„ˆì˜ 9001 í¬íŠ¸ë¡œ MinIO ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì£¼ì†Œë¥¼ ì—´ì–´ì¤ë‹ˆë‹¤.
- <var>healthcheck</var> : 

  - MinIO ì„œë²„ê°€ ì˜ ë„ì›Œì¡ŒëŠ”ì§€ ìƒíƒœë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ìƒíƒœë¥¼ ì²´í¬í•˜ëŠ” êµ¬ë¬¸ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

</CodeDescription>

## 3. MLflow Server

ì•ì„œ ë§Œë“  Backend Store ì™€ Artifact Store ì— ì ‘ê·¼ ê°€ëŠ¥í•œ MLflow ì„œë²„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

### 3.1 Dockerfile

MLflow ì„œë²„ì— í•„ìš”í•œ íŒ¨í‚¤ì§€ê°€ ì„¤ì¹˜ëœ ì´ë¯¸ì§€ë¥¼ build í•  Dockerfile ì„ ì‘ì„±í•©ë‹ˆë‹¤.  
ì„œë²„ë¥¼ ë„ìš¸ ë•Œ, MinIO ì— ì´ˆê¸° bucket ì„ ìƒì„±í•˜ê¸° ìœ„í•´ MinIO Client ë„ í•¨ê»˜ ì„¤ì¹˜í•©ë‹ˆë‹¤.

<CodeDescription>

```docker  title="Dockerfile"
FROM amd64/python:3.9-slim

RUN apt-get update && apt-get install -y \
    git \
    wget \
    && rm -rf /var/lib/apt/lists/*

RUN pip install -U pip &&\
    pip install mlflow psycopg2-binary boto3

RUN cd /tmp && \
    wget https://dl.min.io/client/mc/release/linux-amd64/mc && \
    chmod +x mc && \
    mv mc /usr/bin/mc
```

- <var>FROM</var> :

  - Base ì´ë¯¸ì§€ë¥¼ Python 3.9ê°€ í¬í•¨ëœ ì´ë¯¸ì§€ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
- <var>RUN</var> :
  
  - `git` , `wget` ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤. 
  - `git` ì€ MLflow ì„œë²„ ë‚´ë¶€ ë™ì‘ì—, `wget` ì€ MinIO Client ë¥¼ ì„¤ì¹˜í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.
- <var>RUN</var> : 
  
  - MLflow ë¥¼ ë¹„ë¡¯í•´ PostgreSQL DB, AWS S3 ì— ê´€ë ¨ëœ Python íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.
- <var>RUN</var> : 
  
  - ì•ì„œ ì„¤ì¹˜í•œ `wget` ì„ í™œìš©í•˜ì—¬ MinIO Client ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

</CodeDescription>

### 3.2 Docker Compose

ì‘ì„±ëœ Dockerfile ì„ build í•˜ë„ë¡ Compose íŒŒì¼ì˜ `services` íƒ­ ë°‘ì— ì •ì˜í•©ë‹ˆë‹¤. 
  1. MinIO ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ê³„ì • ì •ë³´ë¥¼ í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
  2. ëª¨ë¸ì„ ì €ì¥í•  ë•Œ ì‚¬ìš©í•  MinIO ì´ˆê¸° ë²„ì¼“ì„ ìƒì„±í•©ë‹ˆë‹¤.
  3. MLflow ì„œë²„ë¥¼ ë„ìš°ëŠ” ëª…ë ¹ì–´ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
      - PostgreSQL DB ì— ì—°ê²°í•˜ê¸° ìœ„í•œ keyword argument ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
      - MinIO ì— ì—°ê²°í•˜ê¸° ìœ„í•œ keyword argument ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

<CodeDescription>

```yaml  title="docker-compose.yaml"
version: "3"

services:
  mlflow-server:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: mlflow-server
    depends_on:
      mlflow-backend-store:
        condition: service_healthy
      mlflow-artifact-store:
        condition: service_healthy
    ports:
      - 5001:5000
    environment:
      AWS_ACCESS_KEY_ID: minio
      AWS_SECRET_ACCESS_KEY: miniostorage
      MLFLOW_S3_ENDPOINT_URL: http://mlflow-artifact-store:9000
    command:
      - /bin/sh
      - -c
      - |
        mc config host add mlflowminio http://mlflow-artifact-store:9000 minio miniostorage &&
        mc mb --ignore-existing mlflowminio/mlflow
        mlflow server \
        --backend-store-uri postgresql://mlflowuser:mlflowpassword@mlflow-backend-store/mlflow \
        --default-artifact-root s3://mlflow/ \
        --host 0.0.0.0
```

- <var>depends_on</var> :

  - MLflow ì„œë²„ê°€ ë„ì›Œì§€ê¸° ì „ì—, PostgreSQL DB ì™€ MinIO ì„œë²„ë¥¼ ë¨¼ì € ë„ìš°ë„ë¡ í•©ë‹ˆë‹¤.
- <var>ports</var> :

  - 5001:5000 í¬íŠ¸ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
- <var>environment</var>

  - <var>AWS_ACCESS_KEY_ID</var> : AWS S3 ì˜ credential ì •ë³´ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” MinIO ì˜ <var>MINIO_ROOT_USER</var> ì™€ ë™ì¼í•©ë‹ˆë‹¤.
  - <var>AWS_SECRET_ACCESS_KEY</var> : AWS S3 ì˜ credential ì •ë³´ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” MinIO ì˜ <var>MINIO_ROOT_PASSWORD</var> ì™€ ë™ì¼í•©ë‹ˆë‹¤.
  - <var>MLFLOW_S3_ENDPOINT_URL</var> : AWS S3 ì˜ ì£¼ì†Œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” MinIO ì˜ ì£¼ì†Œì™€ ê°™ìŠµë‹ˆë‹¤.
- <var>command</var> : MinIO ì´ˆê¸° ë²„ì¼“ì„ ìƒì„± í•˜ê³ , MLflow ì„œë²„ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

  - <var>mc config ~</var> : MinIO Client ë¥¼ í™œìš©í•´ MinIO ì„œë²„ì— í˜¸ìŠ¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.
  - <var>mc mb ~</var> : ë“±ë¡ëœ í˜¸ìŠ¤íŠ¸ë¥¼ í†µí•´ ì´ˆê¸° ë²„ì¼“ì„ ìƒì„±í•©ë‹ˆë‹¤.
  - <var>mlflow server</var> : MLflow ì„œë²„ë¥¼ ë™ì‘ì‹œí‚µë‹ˆë‹¤.
  - <var>--backend-store-uri</var> : ëª…ì‹œëœ ì •ë³´ë¥¼ í†µí•´ PostgreSQL DB ì™€ ì—°ê²°í•©ë‹ˆë‹¤.
  - <var>--default-artifact-root</var> : ëª…ì‹œëœ ë²„ì¼“ì„ í†µí•´ MinIO ì˜ ì´ˆê¸° ë²„ì¼“ê³¼ ì—°ê²°í•©ë‹ˆë‹¤.

</CodeDescription>

## 4. Docker Compose ë¥¼ ì´ìš©í•˜ì—¬ ì„œë¹„ìŠ¤ ë„ìš°ê¸°

ì™„ì„±ëœ Dockerfile ê³¼ Compose íŒŒì¼ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

### 4.1 Dockerfile

```docker  title="Dockerfile"
FROM amd64/python:3.9-slim

RUN apt-get update && apt-get install -y \
    git \
    wget \
    && rm -rf /var/lib/apt/lists/*

RUN pip install -U pip &&\
    pip install boto3==1.26.8 mlflow==1.30.0 psycopg2-binary

RUN cd /tmp && \
    wget https://dl.min.io/client/mc/release/linux-amd64/mc && \
    chmod +x mc && \
    mv mc /usr/bin/mc
```

### 4.2 Docker Compose

```yaml  title="docker-compose.yaml"
version: "3"

services:
  mlflow-backend-store:
    image: postgres:14.0
    container_name: mlflow-backend-store
    environment:
      POSTGRES_USER: mlflowuser
      POSTGRES_PASSWORD: mlflowpassword
      POSTGRES_DB: mlflow
    healthcheck:
      test: ["CMD", "pg_isready", "-q", "-U", "mlflowuser", "-d", "mlflow"]
      interval: 10s
      timeout: 5s
      retries: 5

  mlflow-artifact-store:
    image: minio/minio
    container_name: mlflow-artifact-store
    ports:
      - 9000:9000
      - 9001:9001
    environment:
      MINIO_ROOT_USER: minio
      MINIO_ROOT_PASSWORD: miniostorage
    command: server /data/minio --console-address :9001
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 30s
      timeout: 20s
      retries: 3

  mlflow-server:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: mlflow-server
    depends_on:
      mlflow-backend-store:
        condition: service_healthy
      mlflow-artifact-store:
        condition: service_healthy
    ports:
      - 5001:5000
    environment:
      AWS_ACCESS_KEY_ID: minio
      AWS_SECRET_ACCESS_KEY: miniostorage
      MLFLOW_S3_ENDPOINT_URL: http://mlflow-artifact-store:9000
    command:
      - /bin/sh
      - -c
      - |
        mc config host add mlflowminio http://mlflow-artifact-store:9000 minio miniostorage &&
        mc mb --ignore-existing mlflowminio/mlflow
        mlflow server \
        --backend-store-uri postgresql://mlflowuser:mlflowpassword@mlflow-backend-store/mlflow \
        --default-artifact-root s3://mlflow/ \
        --host 0.0.0.0
```
### 4.3 ì‹¤í–‰

Dockerfile ê³¼ Compose ë‘ íŒŒì¼ì´ ìˆëŠ” ê²½ë¡œì—ì„œ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í™œìš©í•´ ì •ì˜ëœ ì„œë¹„ìŠ¤ë¥¼ ë°±ê·¸ë¼ìš´ë“œ í”„ë¡œì„¸ìŠ¤ë¡œ ë„ì›ë‹ˆë‹¤.

```bash
# terminal-command
docker compose up -d
```

1. [localhost:5001](http://localhost:5001) ì— ì ‘ì†í•˜ì—¬ MLflow ì„œë²„ ë™ì‘ì„ í™•ì¸í•©ë‹ˆë‹¤.
  <div style={{textAlign: 'center'}}>
  
    ![MLflow ui](./img/model-registry-3.png)
    [ê·¸ë¦¼ 3-3] MLflow UI
  </div>
2. [localhost:9001](http://localhost:9001) ì— ì ‘ì†í•˜ì—¬ MinIO ì„œë²„ ë™ì‘ì„ í™•ì¸í•©ë‹ˆë‹¤.
  <div style={{textAlign: 'center'}}>

    ![MinIO ui](./img/model-registry-4.png)
    [ê·¸ë¦¼ 3-4] MinIO Login í™”ë©´
  </div>
  
  MinIO ì— ë¡œê·¸ì¸í•  ìˆ˜ ìˆëŠ” ì•„ì´ë””ëŠ” ìœ„ì—ì„œ ì„¤ì •í•œ minio / miniostorage ì…ë‹ˆë‹¤.    
  í•´ë‹¹ ì •ë³´ë¡œ ë¡œê·¸ì¸í•˜ì—¬ ì•„ë˜ì˜ [ê·¸ë¦¼ 3-5] ì™€ ê°™ì€ í™”ë©´ì´ ë³´ì´ëŠ” ì§€ í™•ì¸í•©ë‹ˆë‹¤.
  <div style={{textAlign: 'center'}}>

    ![MinIO ui](./img/model-registry-5.png)
    [ê·¸ë¦¼ 3-5] MinIO ì ‘ì† í™”ë©´
  </div>
