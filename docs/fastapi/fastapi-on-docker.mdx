---
sidebar_position: 4
description: π“ μ•μ„ μ‘μ„±ν• API λ¥Ό Docker λ¥Ό μ΄μ©ν•μ—¬ μ‹¤ν–‰ν•©λ‹λ‹¤.
---

# 4) FastAPI on Docker
import CodeDescription from '@site/src/components/CodeDescription';
import BrowserWindow from '@site/src/components/BrowserWindow';


### λ©ν‘

1. μ•μ„ μ‘μ„±ν• API λ¥Ό Docker λ¥Ό μ΄μ©ν•μ—¬ μ‹¤ν–‰ν•©λ‹λ‹¤.

<details>
<summary>μ¤ν™ λ…μ„Έμ„</summary>
<CodeDescription>

### μ¤ν™ λ…μ„Έμ„

1. μ•μ„ Pydantic μ„ μ΄μ©ν•μ—¬ μμ •ν• API λ¥Ό μ„λ²„λ΅ μ‹¤ν–‰ν•κΈ° μ„ν•΄ Dockerfile μ„ μ‘μ„±ν•©λ‹λ‹¤.
    - Base imageλ” `amd64/python:3.9-slim` μ„ μ‚¬μ©ν•©λ‹λ‹¤.
    - `crud_pydantic.py` λ¥Ό μ΄μ©ν•©λ‹λ‹¤.
    - ν¬νΈλ” default ν¬νΈμΈ 8000λ² ν¬νΈλ¥Ό μ΄μ©ν•©λ‹λ‹¤.
2. [`http://localhost:8000/docs`](http://localhost:8000/docs) μ— μ ‘μ†ν•μ—¬ μ•μ„ μν–‰ν• μ‹λ‚λ¦¬μ¤ λ“±μ΄ μ λ€λ΅ μ‘λ™ν•λ”μ§€ ν™•μΈν•©λ‹λ‹¤.

</CodeDescription>
</details>

---

<BrowserWindow url="https://github.com/mlops-for-mle/mlops-for-mle/tree/main/ch5">

ν•΄λ‹Ή ννΈμ μ „μ²΄ μ½”λ“λ” [mlops-for-mle/ch5/](https://github.com/mlops-for-mle/mlops-for-mle/tree/main/ch5) μ—μ„ ν™•μΈν•  μ μμµλ‹λ‹¤.

```js
ch5
// highlight-next-line
β”β”€β”€ Dockerfile
β”β”€β”€ Makefile
β”β”€β”€ crud_path.py
β”β”€β”€ crud_pydantic.py
β”β”€β”€ crud_query.py
β”β”€β”€ main.py
β”β”€β”€ multi_param.py
β”β”€β”€ path_param.py
β””β”€β”€ query_param.py
```

</BrowserWindow>

## 1. Dockerfile μ‘μ„±

### 1.1 Dockerfile

Dockerfile μ„ μ΄μ©ν•μ—¬ μ•μ„ Pydantic μ„ μ΄μ©ν•μ—¬ μμ •ν• API λ¥Ό μ‘λ™μ‹ν‚¬ μ μλ” API μ„λ²„μ Docker μ΄λ―Έμ§€λ¥Ό λ§λ“¤μ–΄λ³΄κ² μµλ‹λ‹¤.

<CodeDescription>

```docker  title="Dockerfile"
FROM amd64/python:3.9-slim

WORKDIR /usr/app

RUN pip install -U pip \
    && pip install "fastapi[all]"

COPY crud_pydantic.py crud_pydantic.py

CMD ["uvicorn", "crud_pydantic:app", "--host", "0.0.0.0", "--reload"]
```

- <var>RUN</var> : 
  
  - `pip` λ¥Ό λ¨Όμ € μ—…λ°μ΄νΈν• ν›„μ— `fastapi[all]` μ„ μ„¤μΉν•©λ‹λ‹¤.
- <var>COPY</var> : 
  
  - Pydantic μ„ μ΄μ©ν•μ—¬ μμ •ν• API μ μ½”λ“κ°€ λ‹΄κ²¨ μλ” `crud_paydantic.py` λ¥Ό μ»¨ν…μ΄λ„ λ‚΄λ¶€λ΅ λ³µμ‚¬ν•©λ‹λ‹¤.
- <var>CMD</var> : 
  
  - μ»¨ν…μ΄λ„κ°€ μ‹¤ν–‰λ  λ• μν–‰ν•  λ…λ Ήμ–΄μ κΈ°λ³Έκ°’μ„ μ μ–΄μ¤λ‹λ‹¤. 
  - μ—¬κΈ°μ„λ” `uvicorn` μ„ μ΄μ©ν•΄ `crud_pydantic.py` μ—μ„ λ§λ“  FastAPI μ κ°μ²΄ `app` μ„ μ‹¤ν–‰ν•΄ μ¤λ‹λ‹¤.

</CodeDescription>

### 1.2 Build

μ‘μ„±ν• Dockerfile μ„ μ΄μ©ν•΄ μ΄λ―Έμ§€λ¥Ό build ν•©λ‹λ‹¤.

μ΄λ―Έμ§€ μ΄λ¦„μ€ `ch5-api-server` λ΅ ν•κ² μµλ‹λ‹¤.

```bash
# terminal-command
docker build -t ch5-api-server .
```

μ΄λ―Έμ§€κ°€ μ μƒμ„±λμ—λ”μ§€ ν™•μΈν•©λ‹λ‹¤.

```bash
# terminal-command
docker image ls
```

λ‹¤μκ³Ό κ°™μ΄ `ch5-api-server` μ΄λ―Έμ§€κ°€ μ μƒμ„±λμ—μμ„ ν™•μΈν•  μ μμµλ‹λ‹¤.

```bash
# terminal-command
docker image ls
REPOSITORY                  TAG       IMAGE ID       CREATED         SIZE
ch5-api-server             latest    3dec4bf727fe   3 hours ago     249MB
```

### 1.3 Run

μ΄μ  build ν• μ΄λ―Έμ§€λ¥Ό μ‹¤ν–‰ν•΄ λ³΄κ² μµλ‹λ‹¤.

<CodeDescription>

```bash
# terminal-command
docker run -d \
  --name api-server \
  -p 8000:8000 \
  ch5-api-server
```

- `-d` : μ»¨ν…μ΄λ„λ¥Ό detach mode λ΅ μ‹¤ν–‰ν•©λ‹λ‹¤. Detach mode λ€ λ°±κ·ΈλΌμ΄λ“μ—μ„ μ‹¤ν–‰ν•λ” κ²ƒμ„ μλ―Έν•©λ‹λ‹¤.
- `--name` : μ»¨ν…μ΄λ„μ μ΄λ¦„μ„ `api-server` λ΅ μ„¤μ •ν•©λ‹λ‹¤.
- `-p` : ν¬νΈ ν¬μ›λ”©μ„ `8000:8000` μΌλ΅ μ„¤μ •ν•©λ‹λ‹¤.

</CodeDescription>

μ΄μ  μ»¨ν…μ΄λ„κ°€ μ μ‹¤ν–‰λκ³  μλ”μ§€ ν™•μΈν•©λ‹λ‹¤.

```bash
# terminal-command
docker ps
```

μ„μ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•΄λ³΄λ©΄ `api-server` λΌλ” μ΄λ¦„μ„ κ°€μ§„ μ»¨ν…μ΄λ„κ°€ μ‹¤ν–‰λκ³  μμμ„ ν™•μΈν•  μ μμµλ‹λ‹¤.

```bash
# terminal-command
docker ps
CONTAINER ID   IMAGE             COMMAND                  CREATED          STATUS          PORTS                    NAMES
fb72ccf8fb47   ch5-api-server   "uvicorn crud_pydantβ€¦"   13 minutes ago   Up 13 minutes   0.0.0.0:8000->8000/tcp   api-server
```

## 2. API μ„λ²„ μ ‘μ†ν•μ—¬ μ‘λ™ ν™•μΈ

### 2.1 μ‘λ™ ν™•μΈ
μ΄μ  FastAPI λ¥Ό ν†µν•΄ λ§λ“  API μ„λ²„κ°€ μ μ‘λ™ν•λ”μ§€ ν™•μΈν•΄ λ³΄κ² μµλ‹λ‹¤.
API μ„λ²„ μ»¨ν…μ΄λ„λ¥Ό μ‹¤ν–‰ν•  λ• ν¬νΈ ν¬μ›λ”©μ„ `8000:8000` μΌλ΅ ν–μΌλ―€λ΅ 8000λ² ν¬νΈλ΅ μ ‘μ†ν•λ©΄ API μ„λ²„λ΅ μ ‘μ†ν•  μ μμµλ‹λ‹¤.
FastAPI μ—μ„ μ κ³µν•λ” [Interactive API Docs](https://fastapi.tiangolo.com/tutorial/first-steps/#interactive-api-docs) μ— μ ‘μ†ν•λ ¤λ©΄ URL λ’¤μ— `/docs` λ¥Ό λ¶™μ΄λ©΄ λ©λ‹λ‹¤.

[http://localhost:8000/docs](http://localhost:8000/docs) μ— μ ‘μ†ν•λ©΄ λ‹¤μκ³Ό κ°™μ΄ μ ‘μ†μ΄ λλ” κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤.

<div style={{textAlign: 'center'}}>

![API's Swagger UI Screen](./img/fastapi-4.png)
[κ·Έλ¦Ό 5-4] μ‘μ„±ν• APIμ Swagger UI ν™”λ©΄

</div>

[κ·Έλ¦Ό 5-4]μ ν™”λ©΄μ—μ„ μ•μ„ μν–‰ν• μ‹λ‚λ¦¬μ¤μ™€ κ°™μ€ λ‹¤μ–‘ν• μ‘μ—…μ„ ν•΄ λ³΄λ©΄, λ§λ“  API κ°€ μ λ€λ΅ μ‘λ™ν•λ” κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤.

### 2.2 μ»¨ν…μ΄λ„ μΆ…λ£

μ‘λ™μ΄ μ λλ” κ²ƒμ„ ν™•μΈν• ν›„μ—λ” λ‹¤μ μ‹¤μµμ„ μ„ν•΄ μ»¨ν…μ΄λ„λ¥Ό μΆ…λ£ν•΄ μ¤λ‹λ‹¤. λ‹¤μμ λ…λ Ήμ–΄λ¥Ό ν†µν•΄ μΆ…λ£ν•  μ μμµλ‹λ‹¤.

```bash
# terminal-command
docker rm --force api-server
```
