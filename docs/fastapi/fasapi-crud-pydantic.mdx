---
sidebar_position: 3
description: ğŸ“Œ ì•ì„œ ì‘ì„±í•œ API ì—ì„œ Create ë¶€ë¶„ì„ Pydantic ì„ ì´ìš©í•˜ì—¬ ìˆ˜ì •í•©ë‹ˆë‹¤.
---

# 3) FastAPI CRUD (Pydantic)
import CodeDescription from '@site/src/components/CodeDescription';
import PreviewDescription from '@site/src/components/PreviewDescription';
import BrowserWindow from '@site/src/components/BrowserWindow';

<PreviewDescription>

## Chapter Preview
---
### ëª©í‘œ

1. ì•ì„œ ì‘ì„±í•œ API ì—ì„œ Create ë¶€ë¶„ì„ Pydantic ì„ ì´ìš©í•˜ì—¬ ìˆ˜ì •í•©ë‹ˆë‹¤.
2. Pydantic ì„ ì‚¬ìš©í•˜ê¸° ì „ê³¼ í›„ì— ì–´ë– í•œ ì°¨ì´ê°€ ìˆëŠ”ì§€ í•™ìŠµí•©ë‹ˆë‹¤.


### ìŠ¤í™ ëª…ì„¸ì„œ
1. Create API ì—ì„œ ì…ë ¥ìœ¼ë¡œ ë°›ì•„ì•¼ í•˜ëŠ” ê°’ë“¤ì„ `pydantic.BaseModel` ì„ ì´ìš©í•˜ì—¬ ìˆ˜ì •í•©ë‹ˆë‹¤. [[Request Body](https://fastapi.tiangolo.com/tutorial/body/)]
    - `Class CreateIn(BaseModel)` ì„ ì´ìš©
        - `CreateIn` ì—ì„œëŠ” ì´ë¦„ê³¼ ë³„ëª…ì„ ì…ë ¥ë°›ì„ ìˆ˜ ìˆë„ë¡ `name` ê³¼ `nickname` ë³€ìˆ˜ë¥¼ ë§Œë“­ë‹ˆë‹¤.
    - `Class CreateOut(BaseModel)` ì„ ì´ìš©
        - `CreateOut` ì—ëŠ” `status` ì™€ `id` ë³€ìˆ˜ë¥¼ ë§Œë“¤ì–´ Create ì˜ operation function ì—ì„œ ë‘ ë³€ìˆ˜ì˜ ê°’ì„ return í•˜ë„ë¡ í•©ë‹ˆë‹¤.
        - `id` ëŠ” create ë˜ëŠ” ì‹œì ì˜ memory ì— ì¡´ì¬í•˜ëŠ” ë°ì´í„°ì˜ ê°œìˆ˜ë¡œ ì •ì˜í•˜ì—¬ ì‘ì„±í•©ë‹ˆë‹¤.
2. Create í›„ return í•˜ëŠ” ê°’ì„ Response Model ì„ ì´ìš©í•˜ì—¬ ìˆ˜ì •í•©ë‹ˆë‹¤. [[Response Model](https://fastapi.tiangolo.com/tutorial/response-model/)]
3. Pydantic Model ì„ ì‚¬ìš©í•˜ê¸° ì „ê³¼ í›„ì— API ê°€ ì–´ë–»ê²Œ ë‹¬ë¼ì§€ëŠ”ì§€ ë¹„êµí•´ ë´…ë‹ˆë‹¤.

</PreviewDescription>

<BrowserWindow url="https://github.com/mlops-for-mle/mlops-for-mle/tree/main/ch5">

í•´ë‹¹ íŒŒíŠ¸ì˜ ì „ì²´ ì½”ë“œëŠ” [mlops-for-mle/ch5/](https://github.com/mlops-for-mle/mlops-for-mle/tree/main/ch5) ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```js
ch5
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ Makefile
â”œâ”€â”€ crud_path.py
// highlight-next-line
â”œâ”€â”€ crud_pydantic.py
â”œâ”€â”€ crud_query.py
â”œâ”€â”€ main.py
â”œâ”€â”€ multi_param.py
â”œâ”€â”€ path_param.py
â””â”€â”€ query_param.py
```

</BrowserWindow>

## 1. Pydantic Model

Request Body ëŠ” Client ì—ì„œ API ë¡œ ì „ì†¡í•˜ëŠ” ë°ì´í„°ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
ë°˜ëŒ€ë¡œ Response Body ëŠ” API ê°€ Client ë¡œ ì „ì†¡í•˜ëŠ” ë°ì´í„°ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.

ì´ë ‡ê²Œ Client ì™€ API ì‚¬ì´ì— ë°ì´í„°ë¥¼ ì£¼ê³  ë°›ì„ ë•Œ ë°ì´í„°ì˜ í˜•ì‹ì„ ì§€ì •í•´ ì¤„ ìˆ˜ ìˆëŠ”ë°, ì´ë¥¼ ìœ„í•´ Pydantic Model ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 1.1 Base Setting

ë¨¼ì €, ë‹¤ìŒê³¼ ê°™ì´ `pydantic` ìœ¼ë¡œë¶€í„° `BaseModel` ì„ import í•©ë‹ˆë‹¤.

```python
from fastapi import FastAPI, HTTPException
from pydantic import BaseModel
```

ì•ì„œ ì‘ì„±í•œ API ì™€ ë§ˆì°¬ê°€ì§€ë¡œ FastAPI ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•œ í›„ ì…ë ¥ë°›ì€ ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆë„ë¡ `USER_DB` ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
ë˜í•œ, `HTTPException` ì„ ì´ìš©í•˜ì—¬ ì—ëŸ¬ë¥¼ ë°œìƒí•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

```python
# Create a FastAPI Instance
app = FastAPI()

# User database
USER_DB = {}

# Fail response
NAME_NOT_FOUND = HTTPException(status_code=400, detail="Name not found.")
```

### 1.2 Define Input Schema

ë‹¤ìŒìœ¼ë¡œëŠ” ì…ë ¥ë°›ì•„ì•¼ í•˜ëŠ” ë°ì´í„°ì˜ í˜•íƒœë¥¼ ì§€ì •í•´ì¤„ ìˆ˜ ìˆë„ë¡ `CreateIn` í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
`pydantic` ì˜ `BaseModel` ì„ ìƒì†ë°›ì€ `CreateIn` í´ë˜ìŠ¤ì— Request Body ì˜ êµ¬ì„± ìš”ì†Œê°€ ë  ë³€ìˆ˜ë“¤ì„ attribute ë¡œ ì§€ì •í•©ë‹ˆë‹¤.
ì—¬ê¸°ì„œëŠ” ì´ë¦„ê³¼ ë³„ëª…ì„ ì…ë ¥ë°›ì•„ì•¼ í•˜ë¯€ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•©ë‹ˆë‹¤.

```python
class CreateIn(BaseModel):
    name: str
    nickname: str
```

### 1.3 Define Output Schema

ì´ë²ˆì—ëŠ” ë°˜í™˜í•˜ê³ ì í•˜ëŠ” ë°ì´í„°ì˜ í˜•íƒœë¥¼ ì§€ì •í•´ì¤„ ìˆ˜ ìˆë„ë¡ `CreateOut` í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
ë§ˆì°¬ê°€ì§€ë¡œ `pydantic` ì˜ `BaseModel` ì„ ìƒì†ë°›ì€ `CreateOut` í´ë˜ìŠ¤ì— Response Body ì˜ êµ¬ì„± ìš”ì†Œê°€ ë  ë³€ìˆ˜ë“¤ì„ attribute ë¡œ ì§€ì •í•©ë‹ˆë‹¤.
ìŠ¤í™ ëª…ì„¸ì„œì— ë§ë„ë¡ `status` ì™€ `id` ë³€ìˆ˜ë¥¼ ì§€ì •í•´ ì¤ë‹ˆë‹¤.

```python
class CreateOut(BaseModel):
    status: str
    id: int
```

## 2. Response Model

### 2.1 Response Model

`@app.get()`, `@app.post()` ë“± ë‹¤ì–‘í•œ Path Operation ì— `response_model` ì„ ì´ìš©í•˜ì—¬ Response Body ì— ì‚¬ìš©ë  ë°ì´í„° ëª¨ë¸ì„ ì§€ì •í•´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ë˜í•œ, output data ì˜ type ì„ ì²´í¬í•˜ì—¬ ìë™ìœ¼ë¡œ ë³€í™˜ì‹œí‚¤ê³ , type ì´ ìœ íš¨í•œì§€ í™•ì¸í•´ì£¼ê³ , response ë¥¼ ìœ„í•´ ìë™ìœ¼ë¡œ JSON Schema ë¥¼ ì¶”ê°€í•´ ì£¼ëŠ” ë“±ì˜ ì—­í• ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ ì¤‘ì—ì„œë„ `response_model` ì˜ ê°€ì¥ ì¤‘ìš”í•œ ì—­í• ì€ output data ì˜ í˜•íƒœë¥¼ ì œí•œí•´ ì¤„ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.
ì˜ˆë¥¼ ë“¤ë©´, `response_model=CreateOut` ê³¼ ê°™ì´ ì§€ì •í•´ì£¼ë©´ í•´ë‹¹ Path Operation ì´ ì‹¤í–‰ë˜ì—ˆì„ ë•Œ `CreateOut` ì— ì¡´ì¬í•˜ëŠ” attribute ì˜ í˜•íƒœë¡œ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ê²Œ ë©ë‹ˆë‹¤.
ì´ë¥¼ í†µí•´, Create API ì— ì…ë ¥í•˜ëŠ” ë°ì´í„°ë¡œëŠ” `CreateIn` ëª¨ë¸ì„, ë°˜í™˜í•˜ëŠ” ë°ì´í„°ë¡œëŠ” `CreateOut` ëª¨ë¸ì„ ì‚¬ìš©í•˜ë„ë¡ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 2.2 API Code

ë‹¤ìŒê³¼ ê°™ì´ Response Model ì„ í™œìš©í•˜ì—¬ Create API ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```python
@app.post("/users", response_model=CreateOut)
def create_user(user: CreateIn) -> CreateOut:
    USER_DB[user.name] = user.nickname
    return CreateOut(status="success", id=len(USER_DB))
```

ìœ„ì˜ Path Operation Function ì„ ë³´ë©´ parameter ë¡œ `user` ë¥¼ ì…ë ¥ ë°›ê³ , type ì€ `CreateIn` ì¸ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`USER_DB[user.name] = user.nickname` ì™€ ê°™ì´ Pydantic Model ì— ì„ ì–¸ëœ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ DB ì— ì‚¬ìš©ì ì •ë³´ë¥¼ ì €ì¥í•´ ì¤ë‹ˆë‹¤.

Response Body ì— í•„ìš”í•œ ë³€ìˆ˜ëŠ” `response_model` ë¡œ ì§€ì •ëœ `CreateOut` ëª¨ë¸ì˜ ë³€ìˆ˜ì¸ `status` ì™€ `id` ì´ê¸° ë•Œë¬¸ì— ì´ ë³€ìˆ˜ë“¤ì˜ ê°’ì„ ì €ì¥í•´ ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.
`status` ì™€ `id` ê°’ì„ ì¤€ `CreateOut` ì˜ ê°ì²´ë¥¼ return í•˜ë©´ ë©ë‹ˆë‹¤.

ì •ë¦¬í•˜ë©´, `create_user` í•¨ìˆ˜ëŠ” ì…ë ¥ìœ¼ë¡œ `CreateIn` ëª¨ë¸ì„ ë°›ê³ , `CreateOut` ëª¨ë¸ì„ ë°˜í™˜í•¨ìœ¼ë¡œì¨ Request í•  ë•Œì™€ Response í•  ë•Œ ì£¼ê³ ë°›ëŠ” ë°ì´í„°ì— ë‹¤ë¥¸ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê²ƒì…ë‹ˆë‹¤.

### 2.3 `crud_pydantic.py`

ì „ì²´ ì½”ë“œë¥¼ ì‘ì„±í•œ `crud_pydantic.py` ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```python  title="crud_pydantic.py"
# crud_pydantic.py
from fastapi import FastAPI, HTTPException
from pydantic import BaseModel


class CreateIn(BaseModel):
    name: str
    nickname: str


class CreateOut(BaseModel):
    status: str
    id: int

# Create a FastAPI instance
app = FastAPI()

# User database
USER_DB = {}

# Fail response
NAME_NOT_FOUND = HTTPException(status_code=400, detail="Name not found.")


@app.post("/users", response_model=CreateOut)
def create_user(user: CreateIn):
    USER_DB[user.name] = user.nickname
    user_dict = user.dict()
    user_dict["status"] = "success"
    user_dict["id"] = len(USER_DB)
    return user_dict


@app.get("/users")
def read_user(name: str):
    if name not in USER_DB:
        raise NAME_NOT_FOUND
    return {"nickname": USER_DB[name]}


@app.put("/users")
def update_user(name: str, nickname: str):
    if name not in USER_DB:
        raise NAME_NOT_FOUND
    USER_DB[name] = nickname
    return {"status": "success"}


@app.delete("/users")
def delete_user(name: str):
    if name not in USER_DB:
        raise NAME_NOT_FOUND
    del USER_DB[name]
    return {"status": "success"}
```

### 2.4 ì‹¤í–‰
ì‘ì„±í•œ ì½”ë“œë¥¼ ë‹¤ìŒì˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ ì‹¤í–‰í•©ë‹ˆë‹¤.

```bash
# terminal-command
uvicorn crud_pydantic:app --reload
```

ì´ì œ [`http://localhost:8000/docs`](http://localhost:8000/docs) ì— ì ‘ì†í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ Swagger UI í™”ë©´ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<div style={{textAlign: 'center'}}>

![crud_pydantic.py run screen](./img/fastapi-6.png)
[ê·¸ë¦¼ 5-6] `crud_pydantic.py` ì‹¤í–‰ í™”ë©´

</div>

[ê·¸ë¦¼ 5-6]ì˜ í™”ë©´ì—ì„œ Pydantic Model ì„ ì‚¬ìš©í•˜ì—¬ ìˆ˜ì •í•œ POST Method ë¥¼ í´ë¦­í•˜ì—¬ ìˆ˜ì •í•˜ê¸° ì „í›„ë¥¼ ë¹„êµí•´ ë´…ì‹œë‹¤.

<div style={{textAlign: 'center'}}>

![crud_pydantic.py run screen](./img/fastapi-7.png)
[ê·¸ë¦¼ 5-7] Pydantic Model ë¡œ ìˆ˜ì •í•˜ê¸° ì „ POST Method

</div>

Pydantic Model ë¡œ ìˆ˜ì •í•˜ê¸° ì „ì—ëŠ” [ê·¸ë¦¼ 5-7]ê³¼ ê°™ì´ parameter ë¥¼ ì´ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì „ë‹¬í–ˆìŠµë‹ˆë‹¤.

<div style={{textAlign: 'center'}}>

![crud_pydantic.py run screen](./img/fastapi-8.png)
[ê·¸ë¦¼ 5-8] Pydantic Model ë¡œ ìˆ˜ì •í•œ í›„ POST Method

</div>

ë°˜ë©´, Pydantic Model ë¡œ ìˆ˜ì •í•œ í›„ì—ëŠ” [ê·¸ë¦¼ 5-8]ê³¼ ê°™ì´ Request Body ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## 3. Pydantic Model ì‚¬ìš© ì „í›„ ë¹„êµ

ìœ„ì™€ ê°™ì´ Pydantic Model ì„ ì‚¬ìš©í•œ í´ë˜ìŠ¤ë¥¼ Response Model ë¡œ ì§€ì •í•˜ì—¬ Create API ë¥¼ ìˆ˜ì •í•˜ì˜€ìŠµë‹ˆë‹¤.
ì´ì²˜ëŸ¼ Pydantic Model ì„ í†µí•´ Response Model ì„ ì‚¬ìš©í•˜ë©´ ì…ë ¥ ë°›ëŠ” íŒŒë¼ë¯¸í„°ì™€ ìƒì„± í›„ ë°˜í™˜í•˜ëŠ” íŒŒë¼ë¯¸í„°ë¥¼ ë‹¤ë¥´ê²Œ ì§€ì •í•´ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ëŸ¬í•œ ê¸°ëŠ¥ì€ ë¹„ë°€ë²ˆí˜¸ì²˜ëŸ¼ ì‚¬ìš©ìê°€ í•„ìˆ˜ì ìœ¼ë¡œ ì…ë ¥í•´ì•¼ í•˜ì§€ë§Œ ë°˜í™˜ ê°’ì—ëŠ” ë‚˜íƒ€ë‚˜ë©´ ì•ˆ ë˜ëŠ” íŒŒë¼ë¯¸í„°ë¥¼ ì§€ì •í•  ë•Œ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
